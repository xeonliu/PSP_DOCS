<html lang="jp">
<head>
<title>Utility_Savedata-Overview</title>
<meta http-equiv="Content-Type" content= text/html; charset=Shift_JIS>
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="Text/css>
<meta name="Author"Content=" Sony Computer Entertainment Inc.">
</head>
<body bgcolor="#ffffff" text="#000000" >
<a name=TOP></a>
<table WIDTH="100%">
<tr><td>
<h3>PSP&reg; Programmer Tool Runtime Library Release 6.6.0</h3>
</td>
</tr>
</table>
<hr noshade size=6>
<center><h1>
セーブデータユーティリティ
</h1></center>
</a>
<!-- sce_hd1 -->

<!-- sce_hd3 -->
<a name="Heading3_1">
<h2>
 1 <!-- hp --><b>ユーティリティについて</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">ユーティリティの概要などについては、ユーティリティサービスoverviewドキュメントを参照ください。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_2">
<h2>
 2 <!-- hp --><b>セーブデータの構造</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_2_1">
<h3>
<a href="#Heading3_2"> 2. </a>1 
<!-- hp1 --><b>ディレクトリ/ファイル構成</b><br>
</a>
</h3>
<div style="margin-left:50px;">Memory Stick&trade;上のディレクトリ/ファイル構成です。<br></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese001.gif">
</div>
<div style="margin-left:50px;"><br>※上記構成に含まれない、ファイルやディレクトリの作成は禁止いたします。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_2">
<h3>
<a href="#Heading3_2"> 2. </a>2 
<!-- hp1 --><b>セーブデータディレクトリsavedata_dir</b><br>
</a>
</h3>
<div style="margin-left:50px;">品番（タイトルID）とユーザIDを単純に連結したものをディレクトリ名とします。<br>（品番、ユーザIDの指定などについては、セーブデータユーティリティreferenceドキュメントを参照してください。）<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_3">
<h3>
<a href="#Heading3_2"> 2. </a>3 
<!-- hp1 --><b>PARAM.SFO</b><br>
</a>
</h3>
<div style="margin-left:50px;">ユーティリティが自動的に作成します。タイトル名などのテキストデータ、パレンタルロックレベルなどのパラメータ、保護ありデータファイルのファイルリストが書かれています。<br>保護されているため、ゲームプログラムが直接変更することはできません。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_4">
<h3>
<a href="#Heading3_2"> 2. </a>4 
<!-- hp1 --><b>コンテンツ情報ファイル</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_2_4_1">
<div style="margin-left:40px;"><h4><b>コンテンツ情報ファイルとは？</b><br><br></h4></div></a>

<div style="margin-left:67px;">セーブデータの内容を代表して表現する画像や映像、BGMをコンテンツ情報と呼びます。主にPSP&reg;システムソフトウェア、ユーティリティでのリスト表示に使用されます。<br></div>

<!-- sce_title -->
<a Name ="HeadingT_2_4_2">
<div style="margin-left:40px;"><h4><b>ファイル構成</b><br><br></h4></div></a>

<div style="margin-left:67px;">複数のファイルで構成されます。<br></div>
</ul>
<div style="margin-left:70px;"><ul>
<li> 静止画アイコン：ICON0.PNG
<li> 動画アイコン：ICON1.PMF
<li> コンテンツ情報背景画像：PIC1.PNG
<li> BGM：SND0.AT3
</ul></div>

<!-- sce_title -->
<a Name ="HeadingT_2_4_3">
<div style="margin-left:40px;"><h4><b>静止画アイコン</b><br><br></h4></div></a>

<div style="margin-left:67px;">コンテンツにフォーカスが当たっていない場合や、動画アイコンの読み込み時、動画アイコンが設定されない場合の代替アイコンとして表示されます。<br>必須のファイルとなります。必ず作成してください。<br></div>
<div style="margin-left:70px;"><ul>
<li> 画サイズ：144×80ピクセル
<li> 画像フォーマット：PNG(24bit)
<li> ファイル名：ICON0.PNG
<li> 作成ツール：市販のツールなどを使用します。
</ul></div>

<!-- sce_title -->
<a Name ="HeadingT_2_4_4">
<div style="margin-left:40px;"><h4><b>動画アイコン</b><br><br></h4></div></a>

<div style="margin-left:67px;">動画をアイコンとして表示できます。音声付きにすることができます。<br>再生が終了すると最初から再生が始まりますが、音声は途切れてしまいます。音声を途切れなくループさせる場合はBGMを使用してください。ただし、BGMは動画アイコンに同期しません。<br>音声付き動画であっても、BGMがある場合は、音声はBGMのみ再生されます。<br>オプション扱いなので、必要ない場合は省略することができます。<br>PSP&reg;システムソフトウェアでは再生されますが、ユーティリティでは再生されません。<br></div>
<div style="margin-left:70px;"><ul>
<li> 画サイズ：144×80ピクセル
<li> 映像<br>フォーマット：AVCのみでエンコードされたIDR-Picture, P-Pictureで構成<br>　　　　　　　(Main Profile Level2.1(最大ビットレート4.8Mbps)) ※ゲーム用と同様<br>フレームレート：29.97fps progressive
<li> 音声<br>フォーマット：ATRAC3plus&trade;<br>サンプリング周波数：44.1kHz<br>チャンネル：2 channel stereo
<li> 多重化フォーマット：PSMF
<li> ファイルサイズ：BGMファイルと合わせて最大500キロバイト
<li> ファイル名：ICON1.PMF
<li> 作成ツール：弊社提供のUMD&reg; Stream Composer（for Game Movie）およびPSMF Composerをご使用ください。
</ul></div>

<!-- sce_title -->
<a Name ="HeadingT_2_4_5">
<div style="margin-left:40px;"><h4><b>コンテンツ情報背景</b><br><br></h4></div></a>

<div style="margin-left:67px;">背景となる画像です。<br>オプション扱いなので、必要ない場合は省略することができます。<br>PSP&reg;システムソフトウェアでは表示されますが、ユーティリティでは表示されません。<br></div>
<div style="margin-left:70px;"><ul>
<li> 画サイズ：480×272ピクセル
<li> 画像フォーマット：PNG (24bit)
<li> ファイル名：PIC1.PNG
<li> 作成ツール：市販のツールなどを使用します。
</ul></div>

<!-- sce_title -->
<a Name ="HeadingT_2_4_6">
<div style="margin-left:40px;"><h4><b>BGM</b><br><br></h4></div></a>

<div style="margin-left:67px;">音声です。ループ範囲を指定されている場合、途切れなくループ再生することができます。<br>オプション扱いなので、必要ない場合は省略することができます。<br>PSP&reg;システムソフトウェアでは再生されますが、ユーティリティでは再生されません。<br></div>
<div style="margin-left:70px;"><ul>
<li> 音声フォーマット：<br>フォーマット：ATRAC3plus&trade;<br>サンプリング周波数：44.1kHz<br>チャンネル：2 channel stereo
<li> ファイルサイズ：動画アイコンファイルと合わせて最大500キロバイト
<li> ファイル名：SND0.AT3
<li> 作成ツール：弊社提供のat3toolをご使用ください。
</ul></div>

<!-- sce_hd4 -->
<a name="Heading4_2_5">
<h3>
<a href="#Heading3_2"> 2. </a>5 
<!-- hp1 --><b>データファイルgamedata_file…</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_2_5_7">
<div style="margin-left:40px;"><h4><b>ファイル名の制限</b><br><br></h4></div></a>

<div style="margin-left:67px;">データファイルの名前には制限があります。保護あり、保護なし、共通です。<br></div>
<div style="margin-left:70px;"><ul>
<li> 長さ：8.3形式
<li> 使用可能文字：A〜Z 0〜9
</ul></div>
<div style="margin-left:67px;">また、以下の名前はシステムで予約されますので使用しないでください。<br></div>
<div style="margin-left:70px;"><ul>
<li> *.SFO
<li> ICON*.*
<li> PIC*.*
<li> SND*.*
</ul></div>
<div style="margin-left:67px;">* は任意の長さの任意の文字を意味します。<br>ユーティリティはパラメータとして渡された時にチェックし、不正な名前の場合はエラーを返します。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_3">
<h2>
 3 <!-- hp --><b>【 重要 】Runtime Libraryのバージョンによるセーブデータ形式の違い</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">セーブデータは、Runtime Libraryのバージョンによって、形式が一部異なります。<br>以下の形式があります。<br></div>
</ol>
<div style="margin-left:40px;"><ul>
<li> 旧形式1 :  Runtime Library Release 1.0.3/1.5.0/1.5.2の形式
<li> 旧形式2 :  Runtime Library Release 2.0.0/2.5.0/2.6.0の形式
<li> 新形式　:  Runtime Library Release 2.7.1以降(このドキュメントでのバージョン)の形式
</ul></div>
<div style="margin-left:50px;">旧形式2および新形式では、保護ありデータファイルのアクセスにIDを指定することで、より強固な暗号化を行うことができるようになっています。また暗号化方式も形式毎に異なっています。<br>旧形式1を扱うRelease 1.5.2までのゲームプログラムでは、旧形式2および新形式を読み書きできません。また、旧形式2を扱うRelease 2.0.0〜2.6.0のゲームプログラムでは、新形式を読み書きできません。<br>よって、新形式を扱えるゲームが、旧形式1または旧形式2のゲームのセーブデータに対して上書きを行う場合は、それに合った形式で保存する必要があります。<br>旧形式のセーブデータをアクセスするためには、ユーティリティに旧形式であることを指定する必要があります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_1">
<h3>
<a href="#Heading3_3"> 3. </a>1 
<!-- hp1 --><b>注意</b><br>
</a>
</h3>
<div style="margin-left:50px;">特に理由がない限り、旧形式でセーブデータを作成、運用することを禁止します。必ず新形式のセーブデータをご使用ください。<br>旧形式のセーブデータアクセスが必要な場合は、弊社パブリッシャーリレーション部までご相談ください。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_4">
<h2>
 4 <!-- hp --><b>保護とバインド</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_4_1">
<h3>
<a href="#Heading3_4"> 4. </a>1 
<!-- hp1 --><b>セーブデータの保護について</b><br>
</a>
</h3>
<div style="margin-left:50px;">セーブデータ読み込み時、ユーティリティがPARAM.SFOや保護ありデータファイルに不正なデータ変更を検知した場合は、エラーを返し、読み込みは行われません。<br></div>

<!-- sce_title -->
<a Name ="HeadingT_4_1_8">
<div style="margin-left:40px;"><h4><b>注意</b><br><br></h4></div></a>

<div style="margin-left:67px;">保護なしデータファイルではこのエラーを検出できません。保護なしデータファイルをやむを得ず、使用しなければならない場合は、独自暗号化や厳しいチェックなど、ゲームプログラム側で十分な対策を講じるよう、お願いいたします。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_4_2">
<h3>
<a href="#Heading3_4"> 4. </a>2 
<!-- hp1 --><b>保護ありデータファイルID</b><br>
</a>
</h3>
<div style="margin-left:50px;">（Runtime Library Release 2.00からの機能）<br>不正なデータ変更に対するさらなる防御策として、保護ありデータファイルのアクセスにIDを指定することとしました。<br>IDは、保護ありデータファイルを読み書きする際必要となります。同一のユーティリティタイプでも、保護ありファイルをアクセスする場合、しない場合、がありますので、それによって要、不要が決まります。<br>書き込み時に指定したIDと、同じIDを読み込み時にも指定してください。IDが異なる場合は不正データエラーとなり、読み込みは行われません。<br>上書き時は、既存ファイルのIDはチェックされません。ファイル同様、IDも単に上書きされます。<br>IDはゲームプログラム中でいくつも使用して構いませんが、ユーティリティのタイプによって、IDを別個に指定できる範囲が異なります。<br>リスト選択タイプでは、リスト指定したセーブデータすべてに対し、同じIDでアクセスが行われます。<br>連続呼び出し対応タイプでは、1つのセーブデータに含まれる保護ありデータファイル別にそれぞれIDを区別できます。<br></div>

<!-- sce_title -->
<a Name ="HeadingT_4_2_9">
<div style="margin-left:40px;"><h4><b>設定値の制限について</b><br><br></h4></div></a>

<div style="margin-left:67px;">IDは16bytesのバイナリ値です。以下の制限があります。<br></div>
<div style="margin-left:40px;"><ul>
<li> すべて0は禁止されます。指定するとユーティリティはエラーを返します。
<li> すべてがASCII文字コードは避けてください。（ユーティリティエラーにはなりません。）
<li> すべて同じ値は避けてください。たとえば16bytesすべて0xffなど。（ユーティリティエラーにはなりません。）
</ul></div>

<!-- sce_title -->
<a Name ="HeadingT_4_2_10">
<div style="margin-left:40px;"><h4><b>注意</b><br><br></h4></div></a>

<div style="margin-left:67px;">IDが失われると読み込みは完全に不可能となります。IDを複数運用し、一部IDはファイルに書き込むなど、失われる危険性のある仕様にはしないでください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_4_3">
<h3>
<a href="#Heading3_4"> 4. </a>3 
<!-- hp1 --><b>バインドについて</b><br>
</a>
</h3>
<div style="margin-left:50px;">セーブデータはバインド（関連づけ）の仕組みを使って作成されます。<br></div>

<!-- sce_title -->
<a Name ="HeadingT_4_3_11">
<div style="margin-left:40px;"><h4><b>本体バインド</b><br><br></h4></div></a>

<div style="margin-left:67px;">セーブデータが保存されたPSP&reg;以外のPSP&reg;で、そのセーブデータを読み込んだ場合、他のPSP&reg;で保存されたデータであることが、ユーティリティの返り値でわかります。<br>他のPSP&reg;で保存されたデータであっても、セーブデータは正常に読み込まれますので、本体バインドの返り値をどのように評価するかはゲームプログラムに任されています。これによって、他のPSP&reg;で保存されたセーブデータが有効か無効かをゲームプログラムで決められます。<br></div>

<!-- sce_title -->
<a Name ="HeadingT_4_3_12">
<div style="margin-left:40px;"><h4><b>セーブデータの複製</b><br><br></h4></div></a>

<div style="margin-left:67px;">ユーティリティではセーブデータの複製は検知できません。<br>複製はPC機器など他のハードウェアで可能です。<br>PSP&reg;システムソフトウェアにもセーブデータのコピー機能が搭載されていますが、PCでの複製と変わりません。よって、セーブデータを保存したのと別のPSP&reg;でコピーしたとしても、本体バインド情報がコピーしたPSP&reg;へ変更されることはありません。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_5">
<h2>
 5 <!-- hp --><b>セーブデータユーティリティ概要</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">セーブデータユーティリティは、セーブデータに関する操作、ロード、セーブ、削除などを行うユーティリティです。<br>ゲームプログラムはユーティリティを使用して、セーブデータのMemory Stick&trade;への保存や、Memory Stick&trade;からの読み込みを行う必要があります。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_6">
<h2>
 6 <!-- hp --><b>タイプ</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">セーブデータユーティリティは、用途別に様々なタイプで起動することができます。<br>大きく分けて、単独呼び出しタイプ、連続呼び出し対応タイプがあります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_6_1">
<h3>
<a href="#Heading3_6"> 6. </a>1 
<!-- hp1 --><b>単独呼び出しタイプ</b><br>
</a>
</h3>
<div style="margin-left:50px;">単独呼び出しタイプは、ユーティリティ1回の呼び出しで、セーブデータに対する1操作が終了する場合に使用できます。たとえば、1回の呼び出しでセーブデータのロード、セーブが完了する場合です。<br>このタイプの場合、セーブデータのデータファイル構成が制限されます。<br></div>

<!-- sce_hd6 -->
<a name="Heading6_6_1_1">
<div style="margin-left:63px;"><h4><b>単独呼び出しタイプでのデータファイル構成制限</b><br><br></h4></a></div>
<div style="margin-left:80px;"></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese002.gif">
</div>
<div style="margin-left:80px;"><br>図のように、データファイルは保護ありのものが1つのみ保存可能となります。<br><br></div>
<div style="margin-left:50px;">単独呼び出しタイプには、画面表示を伴ってユーザに確認を求める機能まで含めたタイプがあります。また、オートセーブやロード用に画面表示なしのタイプもあります。<br></div>

<!-- sce_hd6 -->
<a name="Heading6_6_1_2">
<div style="margin-left:63px;"><h4><b>画面表示ありのタイプ</b><br><br></h4></a></div>
</ul>
<div style="margin-left:70px;"><ul>
<li> 固定ロード
<li> 固定セーブ
<li> 固定削除
<li> リスト選択ロード
<li> リスト選択セーブ
<li> リスト選択削除
<li> 全セーブデータ対象選択削除
</ul></div>

<!-- sce_hd6 -->
<a name="Heading6_6_1_3">
<div style="margin-left:63px;"><h4><b>画面表示なしのタイプ</b><br><br></h4></a></div>
<div style="margin-left:70px;"><ul>
<li> オートロード
<li> オートセーブ
<li> オート削除
<li> Memory Stick&trade;空き容量およびセーブデータサイズ取得
</ul></div>

<!-- sce_hd4 -->
<a name="Heading4_6_2">
<h3>
<a href="#Heading3_6"> 6. </a>2 
<!-- hp1 --><b>連続呼び出し対応タイプ</b><br>
</a>
</h3>
<div style="margin-left:50px;">単独呼び出しタイプに対して、連続呼び出し対応タイプでは、セーブデータを構成するデータファイルの制限がありません。<br>セーブデータに対する1回の操作（ゲームデータのセーブ、ロード）が、複数のユーティリティ呼び出しを必要とする場合があるため、それに対応しているタイプとなります。<br>このタイプには、画面表示を伴うものはありません。<br></div>

<!-- sce_hd6 -->
<a name="Heading6_6_2_1">
<div style="margin-left:63px;"><h4><b>画面表示なしのタイプ</b><br><br></h4></a></div>
<div style="margin-left:70px;"><ul>
<li> セーブデータ作成（保護ありデータファイル作成可）
<li> 保護ありデータファイル書き込み
<li> 保護ありデータファイル読み込み
<li> 保護ありデータファイル削除
<li> セーブデータ削除
<li> セーブデータユーザIDリスト取得
<li> ファイルリスト取得
<li> セーブデータ保存判定
</ul></div>

<!-- sce_hd6 -->
<a name="Heading6_6_2_2">
<div style="margin-left:63px;"><h4><b>保護なしデータファイル<sup>※</sup>に対応したタイプ（画面表示なし）</b><br><br></h4></a></div>
<div style="margin-left:70px;"><ul>
<li> セーブデータ作成（保護なしデータファイル作成可）
<li> 保護なしデータファイル書き込み
<li> 保護なしデータファイル読み込み
<li> 保護なしデータファイル削除
</ul></div>
<div style="margin-left:80px;">保護なしデータファイルの扱いには十分注意する必要があります。<br></div>

<!-- sce_hd3 -->
<a name="Heading3_7">
<h2>
 7 <!-- hp --><b>単独呼び出しタイプ仕様</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">ユーティリティ1回の呼び出しで、セーブデータに対する操作（ゲームデータのセーブ、ロード）を一通り終えることができる場合に使用するタイプです。<br>保護ありデータファイルを1つだけ作成できます。作成しないことも可能です。<br>連続呼び出し対応タイプと一緒に用いることも可能ですが、ユーティリティの仕様をご理解の上、セーブデータのファイル構成に十分ご注意下さるよう、お願いします。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_1">
<h3>
<a href="#Heading3_7"> 7. </a>1 
<!-- hp1 --><b>画面表示ありのタイプ</b><br>
</a>
</h3>
<div style="margin-left:50px;">ユーザに対して画面表示による確認を行います。<br>Memory Stick&trade;が差されていない場合は、メッセージを表示し、差されるまで待機します。（ユーザによるキャンセルが可能です。）<br>エラーが発生した場合は、画面上でユーザに報告します。<br>ユーザによるキャンセルや、ユーティリティの処理が継続できない時は、ゲームプログラムにエラー値を返します。<br>以下のタイプが該当します。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_2">
<h3>
<a href="#Heading3_7"> 7. </a>2 
<!-- hp1 --><b>固定ロード</b><br>
</a>
</h3>
<div style="margin-left:50px;">指定されたセーブデータをロードします。<br>セーブデータの指定は1つのみです。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_3">
<h3>
<a href="#Heading3_7"> 7. </a>3 
<!-- hp1 --><b>固定セーブ</b><br>
</a>
</h3>
<div style="margin-left:50px;">指定されたセーブデータをセーブします。<br>セーブデータの指定は1つのみです。<br>すでに同じ名前のセーブデータが存在する場合は上書きセーブとなります。<br>上書きか新規作成かの指定はできません。<br>上書きだったか新規作成だったかの取得はできません。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_4">
<h3>
<a href="#Heading3_7"> 7. </a>4 
<!-- hp1 --><b>固定削除</b><br>
</a>
</h3>
<div style="margin-left:50px;">指定されたセーブデータをディレクトリごと削除します。<br>セーブデータの指定は1つのみです。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_5">
<h3>
<a href="#Heading3_7"> 7. </a>5 
<!-- hp1 --><b>リスト選択ロード</b><br>
</a>
</h3>
<div style="margin-left:50px;">リストで複数のセーブデータを指定して、そのうち1つをロードします。<br>セーブデータは1024個まで指定可能です。<br>指定された複数のセーブデータのうち、Memory Stick&trade;を検索して、実際に保存されているセーブデータのみを画面上でリスト表示します。<br>リスト表示時に最初にフォーカスされるセーブデータを指定できます。<br>ユーザによって選択されたセーブデータを1つロードします。複数選択はできません。<br>実際にロードされたセーブデータの情報を返します。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_6">
<h3>
<a href="#Heading3_7"> 7. </a>6 
<!-- hp1 --><b>リスト選択セーブ</b><br>
</a>
</h3>
<div style="margin-left:50px;">リストで複数のセーブデータを指定して、そのうち1つにセーブデータをセーブします。<br>セーブデータは1024個まで指定可能です。<br>指定された複数のセーブデータのうち、Memory Stick&trade;を検索して、実際に保存されているセーブデータは既存のセーブデータとして、セーブされていないものは新規のセーブデータとして、画面上でリスト表示します。<br>リスト表示時に最初にフォーカスされるセーブデータを指定できます。<br>ユーザによって選択されたセーブデータ1つに対してセーブを行います。複数選択はできません。<br>既存のセーブデータが選択された時は、ユーザに確認後上書きセーブとなります。<br>上書きか新規作成かの指定はできません。<br>上書きだったか新規作成だったかの取得はできません。<br>実際にセーブされたセーブデータの情報を返します。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_7">
<h3>
<a href="#Heading3_7"> 7. </a>7 
<!-- hp1 --><b>リスト選択削除</b><br>
</a>
</h3>
<div style="margin-left:50px;">リストで複数のセーブデータを指定して、それらの中からユーザが選択したデータをディレクトリごと削除します。<br>セーブデータは1024個まで指定可能です。<br>指定された複数のセーブデータのうち、Memory Stick&trade;を検索して、実際に保存されているセーブデータのみを画面上でリスト表示します。<br>リスト表示時に最初にフォーカスされるセーブデータを指定できます。<br>削除を繰り返すことで、複数のセーブデータを削除することができます。<br>削除以外に、セーブデータの詳細情報や、Memory Stick&trade;の空き容量を確認することができます。<br>複数削除対応のため、実際に削除されたセーブデータの情報は返しません。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_8">
<h3>
<a href="#Heading3_7"> 7. </a>8 
<!-- hp1 --><b>全セーブデータ対象選択削除</b><br>
</a>
</h3>
<div style="margin-left:50px;">Memory Stick&trade;に保存されているすべてのセーブデータをリスト表示し、ユーザによって選択されたセーブデータをディレクトリごと削除します。<br>削除を繰り返すことで、複数のセーブデータを削除することができます。<br>削除以外に、セーブデータの詳細情報や、Memory Stick&trade;の空き容量を確認することができます。<br>複数削除対応のため、実際に削除されたセーブデータの情報は返しません。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_9">
<h3>
<a href="#Heading3_7"> 7. </a>9 
<!-- hp1 --><b>画面表示なしのタイプ</b><br>
</a>
</h3>
<div style="margin-left:50px;">画面表示は一切行われません。<br>ユーティリティの処理が継続できない時は、ゲームプログラムにエラー値を返します。<br>エラーの表示は適宜ゲームプログラムで行う必要があります。<br>エラー表示のためにメッセージダイアログユーティリティが使用できます。詳細は「エラーダイアログの画面表示」を参照してください。<br>以下のタイプが該当します。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_10">
<h3>
<a href="#Heading3_7"> 7. </a>10 
<!-- hp1 --><b>固定オートロード</b><br>
</a>
</h3>
<div style="margin-left:50px;">指定されたセーブデータをロードします。<br>セーブデータの指定は1つのみです。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_11">
<h3>
<a href="#Heading3_7"> 7. </a>11 
<!-- hp1 --><b>固定オートセーブ</b><br>
</a>
</h3>
<div style="margin-left:50px;">指定されたセーブデータをセーブします。<br>セーブデータの指定は1つのみです。<br>すでに同じ名前のセーブデータが存在する場合は上書きセーブとなります。<br>上書きか新規作成かの指定はできません。<br>上書きだったか新規作成だったかの取得はできません。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_12">
<h3>
<a href="#Heading3_7"> 7. </a>12 
<!-- hp1 --><b>固定オート削除</b><br>
</a>
</h3>
<div style="margin-left:50px;">指定されたセーブデータをディレクトリごと削除します。<br>セーブデータの指定は1つのみです。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_7_13">
<h3>
<a href="#Heading3_7"> 7. </a>13 
<!-- hp1 --><b>Memory Stick&trade;空き容量およびセーブデータサイズ取得</b><br>
</a>
</h3>
<div style="margin-left:50px;">Memory Stick&trade;の空き容量、Memory Stick&trade;に保存されているセーブデータのサイズ、ユーティリティに指定したメモリ上のセーブデータがMemory Stick&trade;に保存された場合の予想サイズを取得できます。<br>クラスタサイズを考慮したサイズとなります。<br>PSP&reg;システムソフトウェアと同等の表示を行うための単位付き文字列を取得できます。<br>パッケージなどの表記に使用できるクラスタサイズを32Kに固定したサイズを取得できます。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_8">
<h2>
 8 <!-- hp --><b>連続呼び出しに対応したタイプ仕様</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">セーブデータに対する操作（ゲームデータのセーブ、ロード）を一通り終えるために複数回のユーティリティ呼び出しが必要な場合、使用するタイプです。<br>連続呼び出しに対応するための仕組み（状態、ステータス）を持ちます。<br>すべてオートタイプであるため、ユーザに対して一切、確認や報告の表示が行われません。<br>セーブデータの指定は、（単独呼び出しタイプの）固定およびオートタイプと同じですが、複数のユーティリティを呼び出すため、それぞれ別のセーブデータを指定することで、複数のセーブデータにアクセスすることも可能です。<br>Memory Stick&trade;が挿入されていない、ユーザによるセーブのキャンセル、エラーによってユーティリティの処理が継続できないなどの場合は、ゲームプログラムにエラー値を返します。<br>エラーの表示は適宜ゲームプログラムで行う必要があります。<br>エラー表示のためにメッセージダイアログユーティリティが使用できます。詳細は「エラーダイアログの画面表示」を参照してください。<br>単独呼び出しタイプと一緒に用いることも可能ですが、ユーティリティの仕様をご理解の上、セーブデータのファイル構成に十分ご注意下さるよう、お願いします。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_8_1">
<h3>
<a href="#Heading3_8"> 8. </a>1 
<!-- hp1 --><b>セーブデータ作成（保護ありデータファイル作成可）</b><br>
</a>
</h3>
<div style="margin-left:50px;">セーブデータを作成します。<br><b>【注意】すでに同じディレクトリ名のセーブデータが存在する場合はいったん削除した上で新規に作成されます。</b><br>保護ありデータファイルを1つ、同時に作成することができます。<br>データファイルなしで作成することもできます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_8_2">
<h3>
<a href="#Heading3_8"> 8. </a>2 
<!-- hp1 --><b>保護ありデータファイル書き込み</b><br>
</a>
</h3>
<div style="margin-left:50px;">既存のセーブデータに保護ありデータファイルを追加します。<br>セーブデータが不正と判断された場合はエラーとなります。<br>既に同名のファイルが存在する時は上書きとなります。<br>保護ありデータファイルにはファイル数の制限（99個まで）があります。それを越えて追加しようとした場合はエラーとなります。<br>同時にPARAM.SFOのパラメータ、コンテンツ情報ファイルを変更できます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_8_3">
<h3>
<a href="#Heading3_8"> 8. </a>3 
<!-- hp1 --><b>保護ありデータファイル読み込み</b><br>
</a>
</h3>
<div style="margin-left:50px;">既存のセーブデータから保護ありデータファイルを読み込みます。<br>セーブデータが不正と判断された場合はエラーとなります。<br>同時にPARAM.SFOのパラメータ、コンテンツ情報ファイルを読み込みできます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_8_4">
<h3>
<a href="#Heading3_8"> 8. </a>4 
<!-- hp1 --><b>保護ありデータファイル削除</b><br>
</a>
</h3>
<div style="margin-left:50px;">既存のセーブデータから保護ありデータファイルを削除します。<br>セーブデータが不正と判断された場合はエラーとなります。<br>同時にPARAM.SFOのパラメータ、コンテンツ情報ファイルを変更できます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_8_5">
<h3>
<a href="#Heading3_8"> 8. </a>5 
<!-- hp1 --><b>セーブデータ削除</b><br>
</a>
</h3>
<div style="margin-left:50px;">セーブデータをディレクトリごと削除します。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_8_6">
<h3>
<a href="#Heading3_8"> 8. </a>6 
<!-- hp1 --><b>セーブデータユーザIDリスト取得</b><br>
</a>
</h3>
<div style="margin-left:50px;">セーブデータのリスト（ユーザID部のリスト）を取得します。<br>リストはユーザID部にワイルドカードを指定して取得できます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_8_7">
<h3>
<a href="#Heading3_8"> 8. </a>7 
<!-- hp1 --><b>ファイルリスト取得</b><br>
</a>
</h3>
<div style="margin-left:50px;">指定したセーブデータを構成するファイルのリストを取得します。<br>ファイル名にワイルドカードは指定できませんが、取得したいファイルの種別（PARAM.SFOおよびコンテンツ情報ファイル、保護ありデータファイル、保護なしデータファイル）を指定できます。<br>それぞれの種別で、ファイルリストの項目数の上限を指定できます。<br>セーブデータを構成するファイルとして不適切なもの（たとえば、ファイル名が正しくない、システム予約名を使っている、ディレクトリである）は報告されません。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_8_8">
<h3>
<a href="#Heading3_8"> 8. </a>8 
<!-- hp1 --><b>セーブデータ保存判定</b><br>
</a>
</h3>
<div style="margin-left:50px;">セーブデータがMemory Stick&trade;に保存可能かどうかを判定するタイプです。<br>ユーティリティに与えるパラメータで構成された、これから保存される予定のセーブデータが、現在差されているMemory Stick&trade;に保存される場合を仮定し、空き容量が不足するかどうかを調べます。<br>不足した場合にのみ、不足分のサイズを返します。（不足しない場合は0が返ります。）<br>同名のセーブデータ（やそれを構成するファイル）がすでに存在する場合も考慮されます。<br>このとき、<br></div>
<div style="margin-left:70px;"><ul>
<li> 上書きとなるファイルだけを更新する場合
<li> いったんセーブデータを削除して新規作成する場合
</ul></div>
<div style="margin-left:50px;">の2つの条件で不足サイズを同時に求めます。<br></div>

<!-- sce_title -->
<a Name ="HeadingT_8_8_13">
<div style="margin-left:40px;"><h4><b>データファイルリスト</b><br><br></h4></div></a>

<div style="margin-left:67px;">セーブデータを構成するデータファイルのリストをユーティリティに渡します。<br>それぞれのサイズ（バイト単位）が必要です。<br><b>判定を正しく行うために、ファイルを保存する順序でリストを作成します。</b><br>サイズ順にソートなどの必要はありませんが、上書きの際は、サイズが小さくなるファイル&rarr;サイズが大きくなるファイルの順で書き込めば、Memory Stick&trade;の空き容量を効率的に使用することができます。<br>データファイル以外のファイルについては以下のようになります。<br>PARAM.SFO…自動的に計算されますのでリスト指定は不要です。<br>コンテンツ情報ファイル…データファイルリストとは別に指定します。（セーブデータユーティリティreferenceドキュメントを参照してください。）<br></div>

<!-- sce_hd6 -->
<a name="Heading6_8_8_1">
<div style="margin-left:63px;"><h4><b>サイズ0について</b><br><br></h4></a></div>
<div style="margin-left:80px;">リストのサイズに0を設定したファイルの扱いは、削除ではなく、サイズ0のファイルになることを表します。削除されるファイルの指定はできません。<br></div>
<div style="margin-left:70px;"><ul>
<li> セーブデータ更新の際に、データファイルの削除と追加（サイズ変更）両方が必要な仕様では、「上書きとなるファイルだけを更新する場合」の保存判定ができません。なお、削除だけで更新が済む場合は保存判定の必要はありません。
</ul></div>

<!-- sce_title -->
<a Name ="HeadingT_8_8_1_14">
<div style="margin-left:40px;"><h4><b>データファイルの保存順番</b><br><br></h4></div></a>

<div style="margin-left:67px;">いったんセーブデータを削除して新規作成する場合は気にする必要はありませんが、上書きとなるファイルだけを更新する場合は、判定の後、データファイルを保存する順番が重要となります。（理由は次項「上書き時の保存判定内部動作」を参照ください。）<br>セーブデータ保存判定タイプは以下の順序を前提として判定します。<br></div>
</ol>
<div style="margin-left:55px;"><ol>
<li VALUE=1> ディレクトリサイズ</li>
<li VALUE=2> コンテンツ情報ファイル（ICON0.PNG、ICON1.PMF、PIC1.PNG、SND0.AT3）</li>
<li VALUE=3> 保護なしデータファイルリスト順</li>
<li VALUE=4> 保護ありデータファイルリスト順</li>
<li VALUE=5> PARAM.SFO</li>
</ol></div>
<div style="margin-left:67px;">保存判定タイプを呼び出した後、実際にファイル追加タイプでデータファイルを更新する際は、指定したファイルリスト順番通りに行ってください。<br>コンテンツ情報ファイルは、データファイルよりも先に判定されますので、連続で呼び出される一連のユーティリティのうち、最初に更新が可能なタイプで更新します。<br></div>

<!-- sce_title -->
<a Name ="HeadingT_8_8_1_15">
<div style="margin-left:40px;"><h4><b>上書き時の保存判定内部動作</b><br><br></h4></div></a>

<div style="margin-left:67px;">上書き時は、たとえば、以下のような判定を行っています。<br></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese003.gif">
</div>
<div style="margin-left:67px;"><br>FILE A&rarr;FILE B&rarr;…&rarr;FILE Fの順番でファイルを書き込む場合、既存のファイルに上書きすると何クラスタの増減があるか求めて、その毎に空き容量がどのように変化するかを計算します。<br>最終的に空きがある場合でも、途中の増加で不足する場合があることがわかります。ファイルの保存順番は重要です。<br>上記の場合、保存判定タイプは<br></div>
</ol>
<div style="margin-left:70px;"><ul>
<li> 同名ファイルだけを上書きする場合：3クラスタ不足
<li> いったん全削除して新規作成する場合：保存可能
</ul></div>
<div style="margin-left:67px;">を返します。<br>※ディレクトリサイズの差分は簡易的に、<br>　（上書き後のファイル数でのサイズ）−（上書き前のファイル数でのサイズ）<br>　で取得しています。この方法による誤差は無視されます。<br>※保護ありデータファイル、保護なしデータファイル、コンテンツ情報ファイル、<br>　それらすべてのサイズが現状以下になる場合は保存判定の必要はありません。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_9">
<h2>
 9 <!-- hp --><b>保護なしデータファイルに対応したタイプ</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">連続呼び出し対応タイプの保護なしデータファイル版となります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_9_1">
<h3>
<a href="#Heading3_9"> 9. </a>1 
<!-- hp1 --><b>【 重要 】使用にあたっての注意</b><br>
</a>
</h3>
<div style="margin-left:50px;">保護なしデータファイルは、ユーティリティによる改ざん検知ができません。この判断はゲームプログラム側で行う必要があります。使用法によっては、ゲームプログラムばかりでなく、PSP&reg;システムに重大なセキュリティ上の欠陥が発生する危険性があります。<br>ゲーム仕様上どうしても必要な場合以外は、保護ありデータファイルを使っていただくようお願いいたします。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_9_2">
<h3>
<a href="#Heading3_9"> 9. </a>2 
<!-- hp1 --><b>セーブデータ作成（保護なしデータファイル作成可）</b><br>
</a>
</h3>
<div style="margin-left:50px;">セーブデータを作成します。<br><b>【注意】すでに同じディレクトリ名のセーブデータが存在する場合はいったん削除した上で新規に作成されます。</b><br>保護なしデータファイルを1つ、同時に作成することができます。<br>データファイルなしで作成することもできます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_9_3">
<h3>
<a href="#Heading3_9"> 9. </a>3 
<!-- hp1 --><b>保護なしデータファイル書き込み</b><br>
</a>
</h3>
<div style="margin-left:50px;">既存のセーブデータに保護なしデータファイルを追加します。<br>セーブデータが存在しない場合はエラーとなります。<br>既に同名のファイルが存在する時は上書きとなります。<br>同時にPARAM.SFOのパラメータ、コンテンツ情報ファイルを変更できます。<br>既存の保護ありファイルに、同名の保護なしファイルを上書きしようとしても、エラーにはならず、そのまま上書きされます。逆も同様です。エラーにはなりませんが、このような使用は避けてください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_9_4">
<h3>
<a href="#Heading3_9"> 9. </a>4 
<!-- hp1 --><b>保護なしデータファイル読み込み</b><br>
</a>
</h3>
<div style="margin-left:50px;">既存のセーブデータから保護なしデータファイルを読み込みます。<br>セーブデータが存在しない場合はエラーとなります。<br>同時にPARAM.SFOのパラメータ、コンテンツ情報ファイルを読み込みできます。<br>保護ありファイルを保護なしファイルとして読み込んでもエラーは返りませんが、読み込んだ内容は使用できない状態ですので、このような使用は避けてください。<br>逆に保護なしファイルを保護ありファイルとして読み込もうとするとエラーが返ります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_9_5">
<h3>
<a href="#Heading3_9"> 9. </a>5 
<!-- hp1 --><b>保護なしデータファイル削除</b><br>
</a>
</h3>
<div style="margin-left:50px;">既存のセーブデータから保護なしデータファイルを削除します。<br>セーブデータが存在しない場合はエラーとなります。<br>同時にPARAM.SFOのパラメータ、コンテンツ情報ファイルを変更できます。<br>保護ありファイルを保護なしファイルとして削除しても、エラーは返らず、ファイルは削除されます。逆も同様です。エラーにはなりませんが、このような使用は避けてください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_9_6">
<h3>
<a href="#Heading3_9"> 9. </a>6 
<!-- hp1 --><b>セーブデータ削除</b><br>
</a>
</h3>
        <div style="margin-left:80px;"><pre><font size=3>
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_9_7">
<h3>
<a href="#Heading3_9"> 9. </a>7 
<!-- hp1 --><b>セーブデータユーザIDリスト取得</b><br>
</a>
</h3>
        <div style="margin-left:80px;"><pre><font size=3>
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_9_8">
<h3>
<a href="#Heading3_9"> 9. </a>8 
<!-- hp1 --><b>ファイルリスト取得</b><br>
</a>
</h3>
        <div style="margin-left:80px;"><pre><font size=3>
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_9_9">
<h3>
<a href="#Heading3_9"> 9. </a>9 
<!-- hp1 --><b>セーブデータ保存判定</b><br>
</a>
</h3>
        <div style="margin-left:80px;"><pre><font size=3>
</font></pre></div>
<div style="margin-left:50px;">上記4タイプは、保護なしデータファイル用としても共通で使えます。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_10">
<h2>
 10 <!-- hp --><b>補足事項</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_10_1">
<h3>
<a href="#Heading3_10"> 10. </a>1 
<!-- hp1 --><b>上書きについて</b><br>
</a>
</h3>
<div style="margin-left:50px;">セーブデータの上書きを行うタイプの場合、そのとき変更されるファイルのみ更新します。たとえば、PARAM.SFOと上書き指定されたコンテンツ情報ファイル、指定されたファイル名のデータファイルのみ上書きします。上書きされないファイルの削除は行われません。<br>ただし、連続呼び出し対応セーブデータ作成タイプは、セーブデータの新規作成という意味合いから、すでに同じセーブデータが存在する場合は、いったん削除してから新規作成しますのでご注意ください。連続呼び出し対応タイプでファイル更新を行う場合は、データファイル書き込みタイプを使用してください。またこのタイプは、PARAM.SFOの内容更新と、コンテンツ情報ファイルの上書きも同時に行うことができます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_10_2">
<h3>
<a href="#Heading3_10"> 10. </a>2 
<!-- hp1 --><b>ロードについて</b><br>
</a>
</h3>
<div style="margin-left:50px;">ロードを行うタイプはすべて−単独呼び出しロードタイプを含め−複数のデータファイルを持つセーブデータからの読み込みにも対応しています。<br>連続呼び出し対応タイプで複数のデータファイルを持つセーブデータを作成し、それを画面表示付きのロードタイプで読み込むことが可能です。<br>ただしもちろん、1回の呼び出しで1つのファイルしか読み込むことはできません。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_11">
<h2>
 11 <!-- hp --><b>エラーダイアログの画面表示</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">画面表示を伴わないオートタイプ（ロード、セーブ、削除）および、連続呼び出し対応タイプすべてで返されるエラーについて、メッセージダイアログユーティリティを利用してエラーダイアログを画面表示することができます。<br>エラー値を渡すだけで、画面文言も自動的に出力されます。文言を別の表記にすることも可能です。<br>（メッセージダイアログユーティリティのオプション、エラーダイアログ画面操作などについては「ユーティリティサービスoverviewドキュメント」を参照ください。）<br><br>前述したタイプのエラーは基本的にすべて対応しますが、例外が1つあります。連続呼び出し対応タイプのステータスエラー（SCE_UTILITY_SAVEDATA_ERROR_MC_STATUS_ERROR）は、メッセージダイアログユーティリティに指定すると、未対応でエラーになります。このエラーはゲームプログラム開発中にだけ発生すべきもので、ステータス管理を正しく行えば発生することはなく、容易に対策が可能なため、あえて未対応としています。<br><br>画面表示を伴うタイプについては、エラーダイアログを自動的に出力しますので、上記対応の必要はありません。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_12">
<h2>
 12 <!-- hp --><b>連続呼び出し対応タイプの使い方</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_12_1">
<h3>
<a href="#Heading3_12"> 12. </a>1 
<!-- hp1 --><b>ユーティリティの連続呼び出し</b><br>
</a>
</h3>
<div style="margin-left:50px;">ユーティリティは1回の呼び出しで行える動作が限られます。<br>特にデータファイルに関しては、1回の呼び出しでアクセスできるファイルが1つだけとなります。<br>よって、複数のデータファイルを持つセーブデータの更新には複数回の呼び出しを行う必要があります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_2">
<h3>
<a href="#Heading3_12"> 12. </a>2 
<!-- hp1 --><b>連続呼び出しの問題点</b><br>
</a>
</h3>
<div style="margin-left:50px;">ユーティリティの連続呼び出しを考えてみます。<br>Memory Stick&trade;の抜き差し、サスペンドが、ユーティリティの呼び出しの間に発生しない場合は問題ありません。<br></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese004.gif">
</div>
<div style="margin-left:50px;"><br>Memory Stick&trade;の抜き差し、サスペンドが発生するタイミングがユーティリティ実行中の場合は、ユーティリティがエラーを返しますので、ゲームプログラムはそれを受け取ってエラー処理することができます。<br></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese005.gif">
</div>
<div style="margin-left:50px;"><br>しかし、それがユーティリティの実行中ではない時、エラーを検出できない場合があります。<br><br></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese006.gif">
</div>
<div style="margin-left:50px;"><br>そこで、連続呼び出し対応タイプでは、ユーティリティ呼び出し時に&quot;ステータス&quot;を指定することで、これを解決します。<br></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese007.gif">
</div>
<div style="margin-left:50px;"><br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_3">
<h3>
<a href="#Heading3_12"> 12. </a>3 
<!-- hp1 --><b>ステータスについて</b><br>
</a>
</h3>
<div style="margin-left:50px;">ユーティリティが連続呼び出し対応タイプであるときは、必ずステータスを設定して呼び出します。ステータスには以下の4つがあります。<br></div>
<div style="margin-left:70px;"><ul>
<li> <b>start</b>
<li> <b>relay</b>
<li> <b>end</b>
<li> <b>single</b>
</ul></div>

<!-- sce_hd4 -->
<a name="Heading4_12_4">
<h3>
<a href="#Heading3_12"> 12. </a>4 
<!-- hp1 --><b>ステータス運用中に検知できるエラー</b><br>
</a>
</h3>
<div style="margin-left:50px;">検知可能な挙動は<br></div>
<div style="margin-left:70px;"><ul>
<li> Memory Stick&trade;の抜き差し
<li> サスペンド、レジューム
</ul></div>
<div style="margin-left:50px;">です。これらエラーは別々にアサインされており、メッセージダイアログユーティリティが対応しています。<br>加えて、ステータスの使用方法を誤ったエラー、ステータスエラーも返ります。このエラーに限っては、メッセージダイアログユーティリティは未対応です。（「エラーダイアログの画面表示」項目を参照してください。）<br>上記3つのエラーをまとめて、挙動検知エラーと呼びます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_5">
<h3>
<a href="#Heading3_12"> 12. </a>5 
<!-- hp1 --><b>startステータス</b><br>
</a>
</h3>
<div style="margin-left:50px;">連続呼び出し時の先頭のユーティリティに設定します。<br>挙動検知エラーは返りません。<br>連続呼び出しの間（前のユーティリティが<b>start</b>、<b>relay</b>で呼び出されている時）にこのステータスでユーティリティを呼び出してもステータスエラーにはなりませんが、連続呼び出しは打ち切られます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_6">
<h3>
<a href="#Heading3_12"> 12. </a>6 
<!-- hp1 --><b>relayステータス</b><br>
</a>
</h3>
<div style="margin-left:50px;">連続呼び出し先頭と末尾の間のユーティリティに設定します。<br>挙動検知エラーが返ります。<br>前のユーティリティが<b>start</b>、<b>relay</b>でない場合はステータスエラーとなります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_7">
<h3>
<a href="#Heading3_12"> 12. </a>7 
<!-- hp1 --><b>endステータス</b><br>
</a>
</h3>
<div style="margin-left:50px;">連続呼び出し末尾のユーティリティに設定します。<br>挙動検知エラーが返ります。<br>前のユーティリティが<b>start</b>、<b>relay</b>でない場合はステータスエラーとなります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_8">
<h3>
<a href="#Heading3_12"> 12. </a>8 
<!-- hp1 --><b>singleステータス</b><br>
</a>
</h3>
<div style="margin-left:50px;">連続呼び出ししないユーティリティに設定します。<br>1度の呼び出しでセーブデータに対する操作が完了する場合です。<br>挙動検知エラーは返りません。<br>連続呼び出しの間（前のユーティリティが<b>start</b>、<b>relay</b>で呼び出されている時）にこのステータスでユーティリティを呼び出してもステータスエラーにはなりませんが、連続呼び出しは打ち切られます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_9">
<h3>
<a href="#Heading3_12"> 12. </a>9 
<!-- hp1 --><b>単独呼び出しタイプの扱い</b><br>
</a>
</h3>
<div style="margin-left:50px;">すべて<b>single</b>ステータス扱いとなります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_10">
<h3>
<a href="#Heading3_12"> 12. </a>10 
<!-- hp1 --><b>ステータスの保持</b><br>
</a>
</h3>
<div style="margin-left:50px;">ステータスは、セーブデータユーティリティ以外のユーティリティサービスを起動しても保持されます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_11">
<h3>
<a href="#Heading3_12"> 12. </a>11 
<!-- hp1 --><b>ステータスの使用例</b><br>
</a>
</h3>
<div style="margin-left:50px;">以下のように設定して使用します。<br></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese008.gif">
</div>
<div style="margin-left:50px;"><br>その他の例（《》内はゲームプログラムでの処理）<br><br></div>

<!-- sce_title -->
<a Name ="HeadingT_12_11_16">
<div style="margin-left:40px;"><h4><b>例1</b><br><br></h4></div></a>

</ol>
<div style="margin-left:55px;"><ol>
<li VALUE=1> start：セーブデータユーザIDリスト取得</li>
<li VALUE=2> 《リスト選択画面表示を行う》</li>
<li VALUE=3> relay：セーブデータ保存判定</li>
<li VALUE=4> 《空きが不足している場合はエラー処理へ》</li>
<li VALUE=5> 《データファイル1イメージ作成》</li>
<li VALUE=6> relay：セーブデータ作成</li>
<li VALUE=7> 《データファイル2イメージ作成》</li>
<li VALUE=8> end：データファイル追加</li>
</ol></div>

<!-- sce_title -->
<a Name ="HeadingT_12_11_17">
<div style="margin-left:40px;"><h4><b>例2</b><br><br></h4></div></a>

<div style="margin-left:55px;"><ol>
<li VALUE=1> single：データファイル削除</li>
</ol></div>

<!-- sce_hd4 -->
<a name="Heading4_12_12">
<h3>
<a href="#Heading3_12"> 12. </a>12 
<!-- hp1 --><b>ステータスの間違った使用例</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_12_12_18">
<div style="margin-left:40px;"><h4><b>誤使用例</b><br><br></h4></div></a>

<div style="margin-left:55px;"><ol>
<li VALUE=1> start：セーブデータユーザIDリスト取得</li>
<li VALUE=2> 《上記を使用してセーブデータリスト作成》</li>
<li VALUE=3> 単独呼び出しタイプ：リスト選択ロード…NG</li>
</ol></div>
<div style="margin-left:67px;">単独呼び出しタイプは、ステータス管理することができません。リスト取得の直後に<br>Memory Stick&trade;が抜き換えられると、その後のリスト選択ロードはエラーを返しませんので、意図した結果にはならないでしょう。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_12_13">
<h3>
<a href="#Heading3_12"> 12. </a>13 
<!-- hp1 --><b>破損データ判定についての注意</b><br>
</a>
</h3>
<div style="margin-left:50px;">連続呼び出しによるセーブデータ作成中に、ユーザがMemory Stick&trade;を引き抜くと、ユーティリティエラーや挙動検知エラーとなります。<br>このときMemory Stick&trade;には作成途中のセーブデータが残ることになります。<br>通常それはユーティリティが破損データとみなし、ゲームプログラムからは見えなくなります。（セーブデータが存在しなかったことになります。）<br>しかしながら、Memory Stick&trade;の引き抜きタイミングによっては、破損とみなされないセーブデータとなる場合があります。<br>たとえば、<br></div>
<div style="margin-left:55px;"><ol>
<li VALUE=1> 《データファイル1イメージ作成》</li>
<li VALUE=2> <b>start</b>：セーブデータ作成（データファイル1作成）</li>
<li VALUE=3> 《データファイル2イメージ作成》</li>
<li VALUE=4> <b>relay</b>：データファイル追加（データファイル2作成）</li>
<li VALUE=5> 《データファイル3イメージ作成》</li>
<li VALUE=6> <b>end</b>：データファイル追加（データファイル3作成）</li>
</ol></div>
<div style="margin-left:50px;">の途中でMemory Stick&trade;が抜かれた場合、ほとんどはセーブデータが破損データと判断され、存在しない状態となりますが、タイミングによっては"いずれかのデータファイルが欠損しているがフォーマット的には正しいセーブデータ"が保存される場合があります。これにより"データファイル1および2はロードできるが、データファイル3はファイルが見つからずにエラーとなる"などが起きえます。<br>ファイル構成が正しいかどうかはユーティリティでは判断できませんので、ゲームプログラムで行う必要があります。<br>このような事態に陥るタイミングをなるべく短くするような調整は行っております。<br>ゲームプログラム側でできる対策として、連続呼び出し期間中のユーティリティが動作していない時間をなるべく短くすることが挙げられます。上記の例で言いますと、<br></div>
<div style="margin-left:55px;"><ol>
<li VALUE=1> 前処理<br>《データファイル1イメージ作成》<br>《データファイル2イメージ作成》<br>《データファイル3イメージ作成》</li>
<li VALUE=2> <b>start</b>：セーブデータ作成（データファイル1作成）</li>
<li VALUE=3> <b>relay</b>：データファイル追加（データファイル2作成）</li>
<li VALUE=4> <b>end</b>：データファイル追加（データファイル3作成）</li>
</ol></div>
<div style="margin-left:50px;">のように呼び出せば、障害が発生することはかなり希です。<br>もちろん、セーブデータの書き込みを伴わない、ファイルリスト取得タイプや、データファイル読み込みタイプではこのような問題は発生しません。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_13">
<h2>
 13 <!-- hp --><b>連続呼び出し対応タイプの使用例</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">連続呼び出し対応タイプのご理解をさらに深めていただけるように例を挙げます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_13_1">
<h3>
<a href="#Heading3_13"> 13. </a>1 
<!-- hp1 --><b>特定セーブデータ作成</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_13_1_19">
<div style="margin-left:40px;"><h4><b>仕様:</b><br><br></h4></div></a>

<div style="margin-left:67px;">セーブデータが単数。<br>新規作成の場合は、データファイルを2つ作成。コンテンツ情報新規。<br>上書きの場合は、データファイル1つだけ上書き更新。コンテンツ情報更新。<br></div>
        <div style="margin-left:80px;"><pre><font size=3>
</font></pre></div>


<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese009.gif">
</div>
<br>

<!-- sce_title -->
<a Name ="HeadingT_13_1_20">
<div style="margin-left:40px;"><h4><b>POINT:</b><br><br></h4></div></a>

<div style="margin-left:67px;">ファイルリスト取得タイプで既存のセーブデータを調査します（Memory Stick&trade;が差されているかも調べることができます。）さらに上書きの場合は、ファイル構成もチェックします。<br>セーブデータ保存判定タイプでは、上書きと新規作成の判定結果は別々に返されます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_13_2">
<h3>
<a href="#Heading3_13"> 13. </a>2 
<!-- hp1 --><b>複数セーブデータ選択作成</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_13_2_21">
<div style="margin-left:40px;"><h4><b>仕様:</b><br><br></h4></div></a>

<div style="margin-left:67px;">セーブデータが複数。<br>リスト表示する。<br>新規作成の場合は、データファイルを2つ作成。コンテンツ情報新規。<br>上書きの場合は、データファイル1つだけ上書き更新。コンテンツ情報更新。<br>※　呼び出すユーティリティは前項「特定セーブデータ作成」と同じです。<br></div>


<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese010.gif">
</div>
<br>

<!-- sce_title -->
<a Name ="HeadingT_13_2_22">
<div style="margin-left:40px;"><h4><b>POINT:</b><br><br></h4></div></a>

<div style="margin-left:67px;">セーブデータユーザIDリスト取得タイプで、既存のセーブデータを検索します<br>（Memory Stick&trade;が差されているかも調べられます）。<br>セーブデータに上書きする場合は、ファイルの構成が正しいかどうかファイルリスト取得タイプを使用してチェックします。<br>セーブデータ保存判定タイプでは、上書きと新規作成の判定結果は別々に返されます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_13_3">
<h3>
<a href="#Heading3_13"> 13. </a>3 
<!-- hp1 --><b>特定セーブデータ内ファイル選択更新</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_13_3_23">
<div style="margin-left:40px;"><h4><b>仕様:</b><br><br></h4></div></a>

<div style="margin-left:67px;">セーブデータは単数だが、中のデータファイルが複数で、それぞれ別のユーザデータ。<br>データファイル構成は1つのシステムデータファイルと、複数のユーザデータファイル。<br>セーブデータ新規作成の場合は、システムとユーザ用にデータファイルを2つ作成。コンテンツ情報新規。<br>ユーザデータ新規作成の場合は、データファイルを1つ作成。コンテンツ情報更新。<br>ユーザデータ上書きの場合は、データファイルを1つ上書き更新。コンテンツ情報更新。<br></div>


<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese011.gif">
</div>
<br>

<!-- sce_title -->
<a Name ="HeadingT_13_3_24">
<div style="margin-left:40px;"><h4><b>POINT:</b><br><br></h4></div></a>

<div style="margin-left:67px;">ファイルリスト取得タイプで既存のセーブデータを調査します（Memory Stick&trade;が差されているかも調べることができます。）さらにファイル構成もチェックします。<br>セーブデータ保存判定タイプでは、上書きと新規作成の判定結果は別々に返されます。ユーザデータの上書きと新規作成の場合は上書き判定結果を使用します。セーブデータ自体を新規作成する場合のみ、新規作成判定結果を使用します。またそれぞれの場合で、セーブデータ保存判定タイプに与えるファイルリストが異なることに注意します。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_13_4">
<h3>
<a href="#Heading3_13"> 13. </a>4 
<!-- hp1 --><b>読み込み、書き込みを連続で使用</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_13_4_25">
<div style="margin-left:40px;"><h4><b>仕様:</b><br><br></h4></div></a>

<div style="margin-left:67px;">ゲームオプション用データファイルを読んで、ユーザデータ用データファイルを上書き、など。<br><br></div>
<div style="margin-left:50px;"></div>

<div style="margin-left:67px;">
<p>
<img src="gif/Utility_Savedata-Overview-Japanese012.gif">
</div>
<div style="margin-left:50px;"><br></div>

<!-- sce_title -->
<a Name ="HeadingT_13_4_26">
<div style="margin-left:40px;"><h4><b>POINT:</b><br><br></h4></div></a>

<div style="margin-left:67px;">データファイルを更新するために、読み込みの後、書き込みする必要がある場合は、書き込みを呼び出す前には必ず保存判定を行います。（読み込みの前でも構いませんが、読み込んだデータの結果如何では、書き込み内容が変化するかもしれません。）<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_14">
<h2>
 14 <!-- hp --><b>関連ファイル</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">セーブデータユーティリティを使用するために必要なファイルは次の通りです。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>カテゴリ</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>ファイル名</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;ヘッダファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;utility_savedata.h&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;スタブライブラリファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;utility_stub.a&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>

<!-- sce_hd3 -->
<a name="Heading3_15">
<h2>
 15 <!-- hp --><b>appendix：セーブデータのサイズ表記について</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_15_1">
<h3>
<a href="#Heading3_15"> 15. </a>1 
<!-- hp1 --><b>ゲーム中で表示するサイズ（必要な場合）</b><br>
</a>
</h3>
<div style="margin-left:50px;">基本的にクラスタサイズ32Kでのサイズを表示して構いません。<br>Memory Stick&trade;が差されている場合はそのクラスタサイズで正確に計算されたサイズを表示し、差されていない場合はクラスタサイズ32Kでのサイズを表示することを推奨します。<br>これらサイズは、Memory Stick&trade;空き容量およびセーブデータサイズ取得タイプ、セーブデータ保存判定タイプで取得できます。（セーブデータ保存判定タイプでは、Memory Stick&trade;を差さなければ、32Kクラスタでサイズを計算します。）<br></div>

<!-- sce_hd4 -->
<a name="Heading4_15_2">
<h3>
<a href="#Heading3_15"> 15. </a>2 
<!-- hp1 --><b>商品パッケージに記載するサイズ</b><br>
</a>
</h3>
<div style="margin-left:50px;">クラスタサイズは32Kと仮定してセーブデータのサイズを求め、それをパッケージでもお使いください。きりのいい数字にするために、多めに表示することも可能です。<br>例：544キロバイト&rarr;550キロバイト<br>このサイズを簡単に求める方法として、セーブデータユーティリティをMemory Stick&trade;空き容量およびセーブデータサイズ取得タイプで使用すれば、クラスタサイズを32Kに仮定したセーブデータサイズを取得できます。<br>また、実際にクラスタサイズ32KのMemory Stick&trade;（256M以上のMemory Stick&trade;をPSP&reg;システムソフトウェアでフォーマットすれば作成できます）へセーブデータを保存し、PSP&reg;システムソフトウェアのセーブデータ管理で表示されるセーブデータサイズを参照することでも取得可能です。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_16">
<h2>
 16 <!-- hp --><b>appendix：Memory Stick&trade;の空き容量表示について</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">PSP&reg;システムソフトウェアでは、Memory Stick&trade;の実際の未使用クラスタ数から2クラスタ分を差し引いた値で空き容量計算し、表示しています。<br>この2クラスタは、システムで必要なディレクトリを作成したり、セーブデータの作成によって、その親ディレクトリが大きくなったりするのを想定し、そのような場合でも正しくセーブデータを保存するための予備、マージンとして使われます。<br>異なるシステム上で空き容量を取得した場合との差異にはご注意ください。<br><br></div>
<p><p><hr>
<div ALIGN="right">
    &copy;2010 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
