<html lang="jp">
<head>
<title>USB_Mic-Overview</title>
<meta http-equiv="Content-Type" content= text/html; charset=Shift_JIS>
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="Text/css>
<meta name="Author"Content=" Sony Computer Entertainment Inc.">
</head>
<body bgcolor="#ffffff" text="#000000" >
<a name=TOP></a>
<table WIDTH="100%">
<tr><td>
<h3>PSP&reg; Programmer Tool Runtime Library Release 6.6.0</h3>
</td>
</tr>
</table>
<hr noshade size=6>
<center><h1>
USBマイク
</h1></center>
</a>
<!-- sce_hd1 -->

<!-- sce_hd3 -->
<a name="Heading3_1">
<h2>
 1 <!-- hp --><b>ライブラリ概要</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_1_1">
<h3>
<a href="#Heading3_1"> 1. </a>1 
<!-- hp1 --><b>概要</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBマイクライブラリは、PSP&reg;専用USBアクセサリの一つであるマイクロホンやカメラ(マイク機能付き)から、USBを介してPCMデータを取り込むためのライブラリです。<br><br>マイク入力を操作するインタフェースは、オーディオドライバが提供しているオーディオ入力のインタフェースと同じ仕様となっています。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_2">
<h3>
<a href="#Heading3_1"> 1. </a>2 
<!-- hp1 --><b>ライブラリ構成</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBマイクライブラリは以下の３つのモジュールから構成されます。<br></div>
</ol>
<div style="margin-left:40px;"><ul>
<li> USBバスドライバ (常駐モジュール)<br>PSP&reg;のUSBのベースとなるドライバ
<li> USBアクセサリベースドライバ<br>USBアクセサリに共通の処理を行うドライバ
<li> USBマイクドライバ<br>マイク入力を操作するインタフェースを提供するドライバ
</ul></div>
<div style="margin-left:50px;"><br>USBバスドライバについては「USB_Driver-Overview」や「USB_Driver-Reference」を参照してください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_3">
<h3>
<a href="#Heading3_1"> 1. </a>3 
<!-- hp1 --><b>USBマイクライブラリの主な機能</b><br>
</a>
</h3>
<div style="margin-left:40px;"><ul>
<li> 取得できるデータ形式は16bit PCMモノラルサンプリング周波数は44100[Hz], 22050[Hz], 11025[Hz]のいずれか
<li> 入力ゲインのマニュアル調整
<li> 入力ゲインのオートレベルコントロール（ALC）
<li> ALC時のノイズゲート機能搭載
<li> ALC動作時のゲイン変化時間設定
</ul></div>
<div style="margin-left:50px;"><br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_4">
<h3>
<a href="#Heading3_1"> 1. </a>4 
<!-- hp1 --><b>関連ファイル</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBマイクライブラリを使用するために必要なファイルは、以下のとおりです。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>カテゴリ</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>ファイル名</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;ヘッダファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;usb.h&nbsp;&nbsp;<br>&nbsp;&nbsp;usbacc.h&nbsp;&nbsp;<br>&nbsp;&nbsp;usbmic.h&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;stubファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;usb_stub.a&nbsp;&nbsp;<br>&nbsp;&nbsp;usbacc_stub.a又はusbacc_stub_weak.a&nbsp;&nbsp;<br>&nbsp;&nbsp;usbmic_stub.a又はusbmic_stub_weak.a&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_hd4 -->
<a name="Heading4_1_5">
<h3>
<a href="#Heading3_1"> 1. </a>5 
<!-- hp1 --><b>サンプルプログラム</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBマイクライブラリのサンプルプログラムとして以下のものがありますので、参照してください。<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_1_5_1"><h4>
(1)&nbsp;<b>devkit/sample/sound/audiorec</b><br></h4>
</a></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_1_5_2"><h4>
(2)&nbsp;<b>devkit/sample/sound/rec_play</b><br></h4>
</a></div>
<div style="margin-left:50px;"><br></div>

<!-- sce_hd3 -->
<a name="Heading3_2">
<h2>
 2 <!-- hp --><b>使用手順の概略</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_2_1">
<h3>
<a href="#Heading3_2"> 2. </a>1 
<!-- hp1 --><b>USBドライバのロード</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBアクセサリベースドライバとUSBマイクドライバをUSBモジュールユーティリティを用いてロードします。モジュールのロード方法についてはサンプルプログラムを参照してください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_2">
<h3>
<a href="#Heading3_2"> 2. </a>2 
<!-- hp1 --><b>USBドライバの初期化処理</b><br>
</a>
</h3>
<div style="margin-left:50px;">以下の順番で<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbStart">sceUsbStart</a>()を実行し、各USBドライバを始動させます。<br></div>
<div style="margin-left:67px;"><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// USBバスドライバの始動
if (<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbStart">sceUsbStart</a>(SCE_USB_BUS_DRIVER_NAME, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBアクセサリベースドライバの始動
if (<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbStart">sceUsbStart</a>(<a href="../peripheral/USB_Mic-Reference-Japanese.htm#SCE_USBACC_NAME">SCE_USBACC_NAME</a>, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBマイクドライバの始動
if (<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbStart">sceUsbStart</a>(<a href="../peripheral/USB_Mic-Reference-Japanese.htm#SCE_USBMIC_NAME">SCE_USBMIC_NAME</a>, 0, NULL) &lt; 0) {
	// エラー処理
}
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_3">
<h3>
<a href="#Heading3_2"> 2. </a>3 
<!-- hp1 --><b>USBデバイスの始動</b><br>
</a>
</h3>
<div style="margin-left:50px;"><a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbActivate">sceUsbActivate</a>()を実行するとUSBデバイスが始動し、自動的にUSBマイクへの電源供給が開始されます。<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbActivate">sceUsbActivate</a>()の引数には、<a href="../peripheral/USB_Mic-Reference-Japanese.htm#SCE_USB_PID_MIC">SCE_USB_PID_MIC</a>を指定してください。<br></div>
<div style="margin-left:67px;"><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// USBデバイスの始動
if (<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbActivate">sceUsbActivate</a>(<a href="../peripheral/USB_Mic-Reference-Japanese.htm#SCE_USB_PID_MIC">SCE_USB_PID_MIC</a>) &lt; 0) {
	// エラー処理
}
</font></pre></div>
<div style="margin-left:50px;"><br>USBデバイスが始動するまでは、マイク入力の初期化とコーデックのパラメータ設定を行う<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicInputInit">sceUsbMicInputInit</a>()と<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicInputInitEx">sceUsbMicInputInitEx</a>()のみ使用することができ、コーデックの設定パラメータは、USBマイクドライバを停止するまで保持されます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_4">
<h3>
<a href="#Heading3_2"> 2. </a>4 
<!-- hp1 --><b>マイク入力操作</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBマイク入力とオーディオ入力のインタフェースは下の表のように対応しており、USBデバイス始動後はオーディオ入力と同じように使用することができます。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>USBマイク入力</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>オーディオ入力</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicInputInit">sceUsbMicInputInit</a>&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;<a href="../sound/AudioInput-Reference-Japanese.htm#sceAudioInputInit">sceAudioInputInit</a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicInputInitEx">sceUsbMicInputInitEx</a>&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;<a href="../sound/AudioInput-Reference-Japanese.htm#sceAudioInputInitEx">sceAudioInputInitEx</a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicInputBlocking">sceUsbMicInputBlocking</a>&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;<a href="../sound/AudioInput-Reference-Japanese.htm#sceAudioInputBlocking">sceAudioInputBlocking</a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicInput">sceUsbMicInput</a>&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;<a href="../sound/AudioInput-Reference-Japanese.htm#sceAudioInput">sceAudioInput</a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicGetInputLength">sceUsbMicGetInputLength</a>&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;<a href="../sound/AudioInput-Reference-Japanese.htm#sceAudioGetInputLength">sceAudioGetInputLength</a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicWaitInputEnd">sceUsbMicWaitInputEnd</a>&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;<a href="../sound/AudioInput-Reference-Japanese.htm#sceAudioWaitInputEnd">sceAudioWaitInputEnd</a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbMicPollInputEnd">sceUsbMicPollInputEnd</a>&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;<a href="../sound/AudioInput-Reference-Japanese.htm#sceAudioPollInputEnd">sceAudioPollInputEnd</a>&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;">ALCなどの説明は、「AudioInput-Overview」を参照してください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_5">
<h3>
<a href="#Heading3_2"> 2. </a>5 
<!-- hp1 --><b>USBデバイスの停止</b><br>
</a>
</h3>
<div style="margin-left:50px;"><a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbDeactivate">sceUsbDeactivate</a>()を実行すると、USBデバイスが停止し、自動的にUSBマイクへの電源供給が停止されます。そのため、しばらくマイク入力を使用しないような場合にUSBデバイスを停止させておくことで、消費電力を抑えることができます。<br></div>
<div style="margin-left:67px;"><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// USBデバイスの停止
if (<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbDeactivate">sceUsbDeactivate</a>() &lt; 0) {
	// エラー処理
}
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_6">
<h3>
<a href="#Heading3_2"> 2. </a>6 
<!-- hp1 --><b>USBドライバの停止</b><br>
</a>
</h3>
<div style="margin-left:50px;">以下の順番で<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbStop">sceUsbStop</a>()を実行し、各USBドライバを停止させます。<br></div>
<div style="margin-left:67px;"><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// USBマイクドライバの停止
if (<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbStop">sceUsbStop</a>(<a href="../peripheral/USB_Mic-Reference-Japanese.htm#SCE_USBMIC_NAME">SCE_USBMIC_NAME</a>, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBアクセサリベースドライバの停止
if (<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbStop">sceUsbStop</a>(<a href="../peripheral/USB_Mic-Reference-Japanese.htm#SCE_USBACC_NAME">SCE_USBACC_NAME</a>, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBバスドライバの停止
if (<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbStop">sceUsbStop</a>(SCE_USB_BUS_DRIVER_NAME, 0, NULL) &lt; 0) {
	// エラー処理
}
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_7">
<h3>
<a href="#Heading3_2"> 2. </a>7 
<!-- hp1 --><b>USBドライバのアンロード</b><br>
</a>
</h3>
<div style="margin-left:50px;">アンロードにもUSBモジュールユーティリティを用います。詳しくはサンプルプログラムを参照してください。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_3">
<h2>
 3 <!-- hp --><b>動作解説</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_3_1">
<h3>
<a href="#Heading3_3"> 3. </a>1 
<!-- hp1 --><b>オーディオ入力のインタフェースとの比較</b><br>
</a>
</h3>
<div style="margin-left:50px;">マイク入力を操作するインタフェースは、オーディオ入力のインタフェースと基本的に同じ仕様となっていますが、マイクが挿されていない場合の挙動は異なっています。<br><br>オーディオ入力とUSBマイク入力では、<br><br>オーディオ入力の場合：<br></div>
<div style="margin-left:40px;"><ul>
<li> マイクの挿抜を検知することができない
<li> マイクが挿されていない状態でも無音のPCMデータを取り込むことができる
</ul></div>
<div style="margin-left:50px;"><br>USBマイク入力の場合：<br></div>
<div style="margin-left:40px;"><ul>
<li> USBマイクの挿抜を検知することができる
<li> USBマイクが接続されていない状態では、PCMデータを取り込むことができない
</ul></div>
<div style="margin-left:50px;"><br>という違いがあります。そのため、オーディオ入力の場合にはマイクが挿されていない状態でも無音のPCMデータが取り込まれますが、USBマイクの場合にはUSBマイクが接続されていない状態では<a href="../peripheral/USB_Mic-Reference-Japanese.htm#SCE_USBMIC_ERROR_NOT_AVAILABLE">SCE_USBMIC_ERROR_NOT_AVAILABLE</a>のエラーが返ります。<br><br>USBマイクを使用する場合、<a href="../peripheral/USB_Mic-Reference-Japanese.htm#SCE_USBMIC_ERROR_NOT_AVAILABLE">SCE_USBMIC_ERROR_NOT_AVAILABLE</a>エラー時には、ユーザにUSBマイクの接続を促すダイアログを表示するなどの対処を行ってください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_2">
<h3>
<a href="#Heading3_3"> 3. </a>2 
<!-- hp1 --><b>USBマイクライブラリに対応していないUSBアクセサリとの接続</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBマイクライブラリに対応していないUSBアクセサリを接続した場合には、そのUSBアクセサリは認識されず、USBアクセサリを接続していない場合と同じ状態になります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_3">
<h3>
<a href="#Heading3_3"> 3. </a>3 
<!-- hp1 --><b>USBアクセサリ以外のUSBホストとの接続</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBマイクライブラリを使用した場合、PSP&reg;はUSBホストからはオーディオクラスのUSBスピーカーとベンダー固有のドライバの２つの複合デバイスとして見えます。そのため、オーディオクラスをサポートした機器に接続した場合はUSBスピーカーとして認識され、ホスト側で再生したサウンドデータをPSP&reg;側でマイク入力として取り込むことができます。<br><br>PSP&reg;専用USBアクセサリに接続されているのか、それ以外のUSBホストに接続されているのかは、<a href="../peripheral/USB_Mic-Reference-Japanese.htm#sceUsbAccGetAuthStat">sceUsbAccGetAuthStat</a>()を使用することで判断できます。<br><br></div>
<p><p><hr>
<div ALIGN="right">
    &copy;2007 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
