<html lang="jp">
<head>
<title>USB_Gps-Overview</title>
<meta http-equiv="Content-Type" content= text/html; charset=Shift_JIS>
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="Text/css>
<meta name="Author"Content=" Sony Computer Entertainment Inc.">
</head>
<body bgcolor="#ffffff" text="#000000" >
<a name=TOP></a>
<table WIDTH="100%">
<tr><td>
<h3>PSP&reg; Programmer Tool Runtime Library Release 6.6.0</h3>
</td>
</tr>
</table>
<hr noshade size=6>
<center><h1>
GPSレシーバー
</h1></center>
</a>
<!-- sce_hd1 -->

<!-- sce_hd3 -->
<a name="Heading3_1">
<h2>
 1 <!-- hp --><b>ライブラリ概要</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_1_1">
<h3>
<a href="#Heading3_1"> 1. </a>1 
<!-- hp1 --><b>概要</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBGPSライブラリは、PSP&reg;専用USBアクセサリの一つであるGPSレシーバーから、USBを介して位置情報を取り込むためのライブラリです。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_2">
<h3>
<a href="#Heading3_1"> 1. </a>2 
<!-- hp1 --><b>ライブラリ構成</b><br>
</a>
</h3>
<div style="margin-left:50px;">USB GPSライブラリは以下の３つのモジュールから構成されます。<br></div>
<div style="margin-left:40px;"><ul>
<li> USBバスドライバ(常駐モジュール)<br>PSP&reg;のUSBのベースとなるドライバ
<li> USBアクセサリベースドライバ<br>USBアクセサリに共通の処理を行うドライバ
<li> USB GPSドライバ<br>GPSレシーバーを操作するインタフェースを提供するドライバ
</ul></div>
<div style="margin-left:50px;"><br>USBバスドライバについては、「USB_Driver-Overview」や「USB_Driver-Reference」を参照してください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_3">
<h3>
<a href="#Heading3_1"> 1. </a>3 
<!-- hp1 --><b>USBGPSライブラリの主な機能</b><br>
</a>
</h3>
<div style="margin-left:50px;">位置情報について<br></div>
<div style="margin-left:40px;"><ul>
<li> 位置情報とGPS衛星情報が取得可能です。
<li> 位置情報として、測位日時、HDOP、測位クォリティ、測位モード、緯度、経度、高度、速度、方向が取得できます。
<li> GPS衛星情報として、視野内の衛星数、各衛星のID、仰角、方位角、受信感度、衛星ごとの測位使用状態が取得できます。
<li> 取得できる位置情報の測地系は、WGS-84となります。
<li> GPSレシーバーのスタティックナビゲーションモードのオン・オフ切り替え。
</ul></div>
<div style="margin-left:50px;"><br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_4">
<h3>
<a href="#Heading3_1"> 1. </a>4 
<!-- hp1 --><b>関連ファイル</b><br>
</a>
</h3>
<div style="margin-left:50px;">USB GPSライブラリを使用するために必要なファイルは、以下のとおりです。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>カテゴリ</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>ファイル名</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;ヘッダファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;usb.h&nbsp;&nbsp;<br>&nbsp;&nbsp;usbacc.h&nbsp;&nbsp;<br>&nbsp;&nbsp;usbgps.h&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;stubファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;usb_stub.a&nbsp;&nbsp;<br>&nbsp;&nbsp;usbacc_stub.a又はusbacc_stub_weak.a&nbsp;&nbsp;<br>&nbsp;&nbsp;usbgps_stub.a又はusbgps_stub_weak.a&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;モジュールファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;usbacc.prx&nbsp;&nbsp;<br>&nbsp;&nbsp;usbgps.prx&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_hd4 -->
<a name="Heading4_1_5">
<h3>
<a href="#Heading3_1"> 1. </a>5 
<!-- hp1 --><b>サンプルプログラム</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBGPSライブラリのサンプルプログラムとして以下のものがありますので、参照してください。<br></div>
<div style="margin-left:40px;"><ul>
<li> devkit/sample/usb/accessory/usbgps/
</ul></div>
<div style="margin-left:50px;"><br></div>

<!-- sce_hd3 -->
<a name="Heading3_2">
<h2>
 2 <!-- hp --><b>使用手順の概略</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_2_1">
<h3>
<a href="#Heading3_2"> 2. </a>1 
<!-- hp1 --><b>USBドライバのロード</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBアクセサリベースドライバとUSB GPSドライバを、USBモジュールユーティリティを用いてロードします。モジュールのロード方法についてはサンプルプログラムを参照してください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_2">
<h3>
<a href="#Heading3_2"> 2. </a>2 
<!-- hp1 --><b>USBドライバの初期化処理</b><br>
</a>
</h3>
<div style="margin-left:50px;">以下の順番で<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbStart">sceUsbStart</a>()を実行し、各USBドライバを始動させます。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// USBバスドライバの始動
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbStart">sceUsbStart</a>(SCE_USB_BUS_DRIVER_NAME, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBアクセサリベースドライバの始動
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbStart">sceUsbStart</a>(SCE_USBACC_NAME, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBGPSドライバの始動
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbStart">sceUsbStart</a>(<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_NAME">SCE_USBGPS_NAME</a>, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBGPSドライバの初期化
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsOpen">sceUsbGpsOpen</a>() &lt; 0) {
	// エラー処理
}
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_3">
<h3>
<a href="#Heading3_2"> 2. </a>3 
<!-- hp1 --><b>USBデバイスの始動</b><br>
</a>
</h3>
<div style="margin-left:50px;"><a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbActivate">sceUsbActivate</a>()を実行するとUSBデバイスが始動し、自動的にGPSレシーバーへの電源供給が開始されます。<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbActivate">sceUsbActivate</a>()の引数には、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USB_PID_GPS">SCE_USB_PID_GPS</a>を指定してください。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// USBデバイスの始動
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbActivate">sceUsbActivate</a>(<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USB_PID_GPS">SCE_USB_PID_GPS</a>) &lt; 0) {
	// エラー処理
}
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_4">
<h3>
<a href="#Heading3_2"> 2. </a>4 
<!-- hp1 --><b>スタティックナビゲーションモードの設定と取得</b><br>
</a>
</h3>
<div style="margin-left:50px;">スタティックナビゲーションモードは、停止時の位置情報のブレをマスクするための機能で、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsSetStaticNavMode">sceUsbGpsSetStaticNavMode</a>()を使用することにより有効・無効を切り替えることができます。<br>また、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetStaticNavMode">sceUsbGpsGetStaticNavMode</a>()を使って、スタティックナビゲーションモードのオン・オフを取得できます。<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsOpen">sceUsbGpsOpen</a>()直後、デフォルトでスタティックナビゲーションモードは、オフになっています。<br></div>
        <div style="margin-left:80px;"><pre><font size=3>
/* 現在のスタティックナビゲーションモードの状態を取得する。*/
<a href="../kernel/Types-Reference-Japanese.htm#SceUChar8">SceUChar8</a> static_nav_mode;
res = <a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetStaticNavMode">sceUsbGpsGetStaticNavMode</a>(&amp;static_nav_mode);
if(res &lt; 0){
	/* エラー */
}
…

/* 現在スタティックナビゲーションモードをオンにする。*/
res = <a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsSetStaticNavMode">sceUsbGpsSetStaticNavMode</a>(<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATIC_NAV_MODE_ENABLE">SCE_USBGPS_STATIC_NAV_MODE_ENABLE</a>);
if(res &lt; 0){
	/* エラー */
}
…

/* 現在スタティックナビゲーションモードをオフにする。*/
res = <a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsSetStaticNavMode">sceUsbGpsSetStaticNavMode</a>(<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATIC_NAV_MODE_DISABLE">SCE_USBGPS_STATIC_NAV_MODE_DISABLE</a>);
if(res &lt; 0){
	/* エラー */
}
…
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_5">
<h3>
<a href="#Heading3_2"> 2. </a>5 
<!-- hp1 --><b>位置情報取得処理</b><br>
</a>
</h3>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5_1"><h4>
(1)&nbsp;<b>有効な位置情報が取得できるまで</b><br></h4>
</a></div>
<div style="margin-left:67px;">USBデバイスの電源投入後、GPSレシーバーの初期化処理が行われます。初期化処理には数秒かかる場合があり、この期間<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetState">sceUsbGpsGetState</a>()を実行した場合、引数stateには、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATE_BUSY">SCE_USBGPS_STATE_BUSY</a>がセットされます。また、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetData">sceUsbGpsGetData</a>()を実行した場合、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_ERROR_BUSY">SCE_USBGPS_ERROR_BUSY</a>を返し、位置情報（<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SceUsbGpsPositionData">SceUsbGpsPositionData</a>）、GPS衛星情報（<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SceUsbGpsSatelliteData">SceUsbGpsSatelliteData</a>）は取得に失敗します。<br>GPSレシーバーの初期化完了後、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetState">sceUsbGpsGetState</a>()を実行した場合、引数stateには、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATE_WORKING">SCE_USBGPS_STATE_WORKING</a>がセットされます。また、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetData">sceUsbGpsGetData</a>()では、GPS衛星情報が取得可能になりますが、位置情報については、初期化処理後GPS衛星捕捉処理（位置情報算出に必要なだけのGPS衛星を捕捉する作業）が必要なため、さらに最短で約15〜50秒程度かかります（周辺環境によっては、さらに時間がかかる場合があります）。<br>位置情報が取得できていない場合、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetData">sceUsbGpsGetData</a>()で取得できる<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SceUsbGpsPositionData">SceUsbGpsPositionData</a>構造体のメンバqualityには、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_POSITION_QUALITY_NOT_AVAILABLE">SCE_USBGPS_POSITION_QUALITY_NOT_AVAILABLE</a>、modeには、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_POSITION_MODE_NOT_AVAILABLE">SCE_USBGPS_POSITION_MODE_NOT_AVAILABLE</a>が設定されます。<br>有効な位置情報が取得できた場合、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetData">sceUsbGpsGetData</a>()で取得した<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SceUsbGpsPositionData">SceUsbGpsPositionData</a>構造体のメンバqualityには、測位クォリティに応じて、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_POSITION_QUALITY_GPS">SCE_USBGPS_POSITION_QUALITY_GPS</a>（GPS単独測位）<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_POSITION_QUALITY_DGPS">SCE_USBGPS_POSITION_QUALITY_DGPS</a>（DGPS測位）が設定され、<br>modeには、測位モードに応じて、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_POSITION_MODE_2D">SCE_USBGPS_POSITION_MODE_2D</a>（2D測位）、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_POSITION_MODE_3D">SCE_USBGPS_POSITION_MODE_3D</a>（3D測位）が設定されます。<br>いったん位置情報が取得できた場合でも、屋内に入るなど、再度位置情報が取得できなくなった場合、quality, modeには<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_POSITION_QUALITY_NOT_AVAILABLE">SCE_USBGPS_POSITION_QUALITY_NOT_AVAILABLE</a>、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_POSITION_MODE_NOT_AVAILABLE">SCE_USBGPS_POSITION_MODE_NOT_AVAILABLE</a>がセットされます。<br><br>以上をまとめると以下のようになります。<br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>処理段階</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>GPSレシーバーの状態</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>測位クォリティ</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>測位モード</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>所要時間</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;初期化&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;BUSY&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;NOT AVAILABLE&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;NOT AVAILABLE&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;数秒&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;GPS衛星捕捉&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;WORKING&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;NOT AVAILABLE&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;NOT AVAILABLE&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;15〜50秒（最短）&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;位置情報取得&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;WORKING&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;GPS or DGPS&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;2D or 3D&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;即時（一秒間隔で&nbsp;&nbsp;<br>&nbsp;&nbsp;更新されます）&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5_2"><h4>
(2)&nbsp;<b>挿抜処理</b><br></h4>
</a></div>
<div style="margin-left:67px;">USBGPSドライバは、GPSレシーバーの挿入を検知し、自動的にGPSレシーバーの起動処理、初期化処理を行います。アプリケーションは、GPSレシーバー挿抜時、位置情報取得に関して特別な処理を行う必要がありません。ただし、アプリケーションのユーザーにGPSレシーバーの挿入を促すなどの処理が必要な場合は、別途、 <a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetState">sceUsbGpsGetState</a>()を使用して、GPSレシーバーの検出を行う必要があります。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// GPSレシーバーの状態検出
while(1){
	int res;
	res = <a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetState">sceUsbGpsGetState</a>(&amp;gAppGlobals.usbgps_state);
	if(res &lt; 0){
		/*J エラー：状態の取得に失敗 */
		break;
	}

	if(gAppGlobals.usbgps_state == <a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATE_WORKING">SCE_USBGPS_STATE_WORKING</a>){
		/*J GPSレシーバーが動作中 */
		<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetData">sceUsbGpsGetData</a>(&amp;gAppGlobals.pos, &amp;gAppGlobals.sat);
	}else if(gAppGlobals.usbgps_state == <a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATE_NOT_AVAILABLE">SCE_USBGPS_STATE_NOT_AVAILABLE</a>){
		/*J GPSレシーバーが存在しない */
	}else if(gAppGlobals.usbgps_state == <a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATE_NOT_ACCESSORY">SCE_USBGPS_STATE_NOT_ACCESSORY</a>){
		/*J "PSP"アクセサリ以外のデバイスが存在する */
	} else if(gAppGlobals.usbgps_state == <a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATE_BUSY">SCE_USBGPS_STATE_BUSY</a>){
		/*J GPSレシーバー初期化処理中 */

	} else {
		/*J エラー：ありえない状態 */
		break;
	}
}
</font></pre></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5_3"><h4>
(3)&nbsp;<b>情報更新間隔</b><br></h4>
</a></div>
<div style="margin-left:67px;"><a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetData">sceUsbGpsGetData</a>()で取得できる位置情報、GPS衛星情報は、最短1秒間隔で更新されます。1秒より短い間隔で、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetData">sceUsbGpsGetData</a>()を実行しても直前のデータと同じデータが取得されます。<br>USB GPSライブラリ内の処理、その他の要因によって、更新間隔が1秒以上になる場合もあります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_6">
<h3>
<a href="#Heading3_2"> 2. </a>6 
<!-- hp1 --><b>USBデバイスの停止</b><br>
</a>
</h3>
<div style="margin-left:50px;"><a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbDeactivate">sceUsbDeactivate</a>()を実行すると、USBデバイスが停止し、自動的にGPSレシーバーへの電源供給が停止されます。そのため、しばらくGPSレシーバーを使用しないような場合にUSBデバイスを停止させておくことで、消費電力を抑えることができます。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// USBデバイスの停止
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbDeactivate">sceUsbDeactivate</a>() &lt; 0) {
	// エラー処理
}
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_7">
<h3>
<a href="#Heading3_2"> 2. </a>7 
<!-- hp1 --><b>USBドライバの停止</b><br>
</a>
</h3>
<div style="margin-left:50px;">以下の順番で<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbStop">sceUsbStop</a>()を実行し、各USBドライバを停止させます。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>// USBGPSドライバの終了処理
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsClose">sceUsbGpsClose</a>() &lt; 0) {
	// エラー処理
}

// USBGPSドライバの停止
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbStop">sceUsbStop</a>(<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_NAME">SCE_USBGPS_NAME</a>, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBアクセサリベースドライバの停止
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbStop">sceUsbStop</a>(SCE_USBACC_NAME, 0, NULL) &lt; 0) {
	// エラー処理
}

// USBバスドライバの停止
if (<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbStop">sceUsbStop</a>(SCE_USB_BUS_DRIVER_NAME, 0, NULL) &lt; 0) {
	// エラー処理
}
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_8">
<h3>
<a href="#Heading3_2"> 2. </a>8 
<!-- hp1 --><b>USBドライバのアンロード</b><br>
</a>
</h3>
<div style="margin-left:50px;">アンロード方法についてはサンプルプログラムを参照してください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_9">
<h3>
<a href="#Heading3_2"> 2. </a>9 
<!-- hp1 --><b>サスペンド・レジューム</b><br>
</a>
</h3>
<div style="margin-left:50px;">サスペンド・レジュームに関して、アプリケーションプログラム側で特に必要な作業はありません。<br>ただし、GPSレシーバー動作中にサスペンド・レジューム処理が発生した場合、サスペンド時、USBデバイスが一旦停止し、GPSレシーバーへの電源供給も停止します。レジューム後は、再度USBデバイスの起動、GPSレシーバーの初期化処理が開始されますので、レジューム直後、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetState">sceUsbGpsGetState</a>()を実行した場合、引数stateには、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_STATE_BUSY">SCE_USBGPS_STATE_BUSY</a>がセットされます。また、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsGetData">sceUsbGpsGetData</a>()を実行した場合、<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SCE_USBGPS_ERROR_BUSY">SCE_USBGPS_ERROR_BUSY</a>を返し、位置情報（<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SceUsbGpsPositionData">SceUsbGpsPositionData</a>）、GPS衛星情報（<a href="../peripheral/USB_Gps-Reference-Japanese.htm#SceUsbGpsSatelliteData">SceUsbGpsSatelliteData</a>）の取得に失敗します。その後、通常にGPSレシーバーを起動したときと同様に、GPSレシーバー初期化処理、GPS衛星捕捉処理終了後、有効な位置情報が取得可能となります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_10">
<h3>
<a href="#Heading3_2"> 2. </a>10 
<!-- hp1 --><b>GPSレシーバー起動時の初期化情報について</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBGPSドライバでは、直前の測位時に取得したGPS衛星の位置情報（エフェメリス）と測位位置をPSP&reg;本体に保存し(※1)、次回起動時の初期化情報として使用しています。こうすることにより、初期化情報がない場合に比べて、位置情報取得までにかかる時間が短縮されます。（最短で通常50秒程度のものが10数秒程度になります）ただし、初期化情報自体に有効時間（2〜3時間程度）があり、直前の測位時刻から有効時間以上経過した場合、位置情報取得までにかかる時間は短縮されません。<br><br>※1：GPS衛星の軌道情報（アルマナック)は、GPSレシーバー内に保存されます。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_3">
<h2>
 3 <!-- hp --><b>動作解説</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_3_1">
<h3>
<a href="#Heading3_3"> 3. </a>1 
<!-- hp1 --><b>USB GPSライブラリに対応していないUSBアクセサリとの接続</b><br>
</a>
</h3>
<div style="margin-left:50px;">USB GPSライブラリに対応していないUSBアクセサリを接続した場合には、そのUSBアクセサリは認識されず、USBアクセサリを接続していない場合と同じ状態になります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_2">
<h3>
<a href="#Heading3_3"> 3. </a>2 
<!-- hp1 --><b>USBアクセサリ以外のUSBホストとの接続</b><br>
</a>
</h3>
<div style="margin-left:50px;">USBGPSライブラリを使用した場合、PSP&reg;はUSBホストからはベンダー固有のドライバとして見えます。<br><br>PSP&reg;専用USBアクセサリに接続されているのか、それ以外のUSBホストに接続されているのかは、sceUsbAccGetAuthStat()を使用することで判断できます。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_3">
<h3>
<a href="#Heading3_3"> 3. </a>3 
<!-- hp1 --><b>スタティックナビゲーションモード</b><br>
</a>
</h3>
<div style="margin-left:50px;">スタティックナビゲーションモードとは、GPSレシーバーが提供する動作モードです。<a href="../peripheral/USB_Gps-Reference-Japanese.htm#sceUsbGpsSetStaticNavMode">sceUsbGpsSetStaticNavMode</a>()を使用することによりGPSレシーバーをスタティックナビゲーションモードで動作させることができます。<br><br>スタティックナビゲーションモードとは、主に自動車やバイクなど徒歩よりも高速で移動する場合に使用することを想定しており、スタティックナビゲーションモードを使用することにより、自動車やバイクなどが停止しているにも関わらず位置情報が変化することを防ぐことができます。<br>実際には、GPSレシーバー内部でGPS衛星電波から算出した位置情報に対して以下のようなフィルタ処理を施しています。<br><br></div>
<div style="margin-left:40px;"><ul>
<li> ある一定速度以下になった場合、位置情報の更新を停止する。
<li> ある一定速度以上になった場合、もしくは、ある一定距離以上移動した場合、位置情報の更新を再開する。
</ul></div>
<div style="margin-left:50px;"><br>なお、位置情報の更新が停止する速度、位置情報の更新を再開する移動距離は、GPSレシーバーによって固定されているので変更することはできません。<br>以下に、同じ場所（TK南青山ビルの北側窓際）で、ほぼ同時刻にGPSレシーバーの通常動作とスタティックナビゲーション動作を行い、それぞれ50秒間測位したときの位置情報をGoogle earthで地図上に表示したものを示します。<br>通常動作時は、GPSレシーバーが停止しているにも関わらず、実際にGPSレシーバーから取得される位置情報はずれていますが、スタティックナビゲーション動作時は、ほとんどずれていないことがわかります。<br>ただし、徒歩時など低速移動中の場合でのスタティックナビゲーション動作は、位置情報の更新が遅れてしまうのでおすすめしません。<br><br></div>

<div align=center>
<p>
<img src="gif/USB_Gps-Overview-Japanese001.jpg">
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>図 1 通常動作</b><br>
</div>
<br>
<div style="margin-left:50px;"><br></div>

<div align=center>
<p>
<img src="gif/USB_Gps-Overview-Japanese002.jpg">
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>図 2 スタティックナビゲーション</b><br>
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_hd3 -->
<a name="Heading3_4">
<h2>
 4 <!-- hp --><b>注意事項</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_4_1">
<h3>
<a href="#Heading3_4"> 4. </a>1 
<!-- hp1 --><b>位置情報取得にかかる時間について</b><br>
</a>
</h3>
<div style="margin-left:50px;">「位置情報取得処理(1)有効な位置情報が取得できるまで」にも書いたように、GPSレシーバー起動後、有効な位置情報が取得できるまで、最短で約15〜50秒程度かかります。<br>また、位置情報が取得可能になるまでの時間は、周囲の状況、直前の測位状態に依存します。一般に、周囲に障害物がある場合には時間がかかります。<br><br>アプリケーションプログラム側では、なるべくこの時間をユーザーに意識させない工夫が必要となります。以下に例をあげます。<br>例：<br></div>
<div style="margin-left:40px;"><ul>
<li> GPS起動後、「位置情報取得中です」などのダイアログを表示し、かつユーザー操作で処理をキャンセルできるようにしておく。
<li> アプリケーション起動直後、UMD&reg;からのデータロード処理など、時間がかかる処理の前にGPSレシーバーを起動しておく。
</ul></div>

<!-- sce_hd4 -->
<a name="Heading4_4_2">
<h3>
<a href="#Heading3_4"> 4. </a>2 
<!-- hp1 --><b>短い時間で位置情報を取得するためのコツ</b><br>
</a>
</h3>
<div style="margin-left:50px;">GPSレシーバーを使って測位を開始する際、以下の条件が満たされていることを確認してください。より短い時間でGPS衛星を補足、測位を開始することができます。<br></div>
<div style="margin-left:40px;"><ul>
<li> PSP&reg;本体の時刻があっている。
<li> 屋外で、かつ、周囲に高い建物がなく開けた場所である。
<li> GPSレシーバーのアンテナを空に向かって水平にする。
<li> 停止した状態で測位できるのを待つ。(※2)
</ul></div>

<!-- sce_hd4 -->
<a name="Heading4_4_3">
<h3>
<a href="#Heading3_4"> 4. </a>3 
<!-- hp1 --><b>PSP&reg;ハードウェアツールでのGPSレシーバー使用時の注意</b><br>
</a>
</h3>
<div style="margin-left:50px;">PSP&reg;ハードウェアツールでGPSレシーバーを使用した場合、PSP&reg;本体でGPSレシーバーを使用する場合に比べ、GPSレシーバーの感度が低下します。そのため、PSP&reg;本体でGPSレシーバーを使用した場合に測位できるような環境でも、PSP&reg;ハードウェアツールでGPSレシーバーを使用した場合には、測位するまでに長時間かかったり、まったく測位できないことがあります。<br><br>※2：測位開始後は、ある程度GPS衛星感度が低下しても測位を続けることが可能なので、移動しても問題ありません。<br><br></div>
<p><p><hr>
<div ALIGN="right">
    &copy;2008 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
