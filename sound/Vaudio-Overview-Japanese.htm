<html lang="jp">
<head>
<title>Vaudio-Overview</title>
<meta http-equiv="Content-Type" content= text/html; charset=Shift_JIS>
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="Text/css>
<meta name="Author"Content=" Sony Computer Entertainment Inc.">
</head>
<body bgcolor="#ffffff" text="#000000" >
<a name=TOP></a>
<table WIDTH="100%">
<tr><td>
<h3>PSP&reg; Programmer Tool Runtime Library Release 6.6.0</h3>
</td>
</tr>
</table>
<hr noshade size=6>
<center><h1>
仮想オーディオドライバ
</h1></center>
</a>
<!-- sce_hd1 -->

<!-- sce_hd3 -->
<a name="Heading3_1">
<h2>
 1 <!-- hp --><b>ライブラリ概要</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_1_1">
<h3>
<a href="#Heading3_1"> 1. </a>1 
<!-- hp1 --><b>機能の概要と特長</b><br>
</a>
</h3>
<div style="margin-left:50px;">vaudioは、PSP&reg;上で動作する各種ライブラリとオーディオ出力機能を組み合わせて使うことで、さまざまな音声加工をした上でオーディオ出力を行うことができるライブラリです。<br>以下のような機能が使用できます。<br><br></div>
<div style="margin-left:40px;"><ul>
<li> サンプリング周波数変換機能<br>48000,44100,32000,24000,22050,16000,12000,11025,8000Hzでサンプリングされた音声を周波数変換して出力することができます。
</ul></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:40px;"><ul>
<li> 自動音量調整機能(ALC)<br>再生される音声の音量が小さすぎたり、大きすぎたりしたときに、聞きやすい音量になるように自動的に調整することができます。
</ul></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:40px;"><ul>
<li> イコライザ機能<br>いくつかのプリセットされた周波数特性を持つイコライザを通すことができます。
</ul></div>

<!-- sce_hd4 -->
<a name="Heading4_1_2">
<h3>
<a href="#Heading3_1"> 1. </a>2 
<!-- hp1 --><b>関連ファイル</b><br>
</a>
</h3>
<div style="margin-left:50px;">vaudioを使用するには次のファイルが必要です。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>カテゴリ</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>ファイル名</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;スタブライブラリファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;vaudio_stub.a&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;ウィークインポートスタブライブラリ&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;vaudio_stub_weak.a&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;ヘッダファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;vaudio.h&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;">また、vaudioモジュール本体をロードするために、モジュールユーティリティを併用する必要があります。詳しくは、別資料「ユーティリティサービス」を参照してください。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_3">
<h3>
<a href="#Heading3_1"> 1. </a>3 
<!-- hp1 --><b>サンプルプログラム</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_1_3_1">
<div style="margin-left:40px;"><h4><b>devkit/sample/sound/mp3play/</b><br><br></h4></div></a>

<div style="margin-left:67px;">MP3をvaudioを用いて再生するサンプルです。vaudioを使うことで、44.1kHz以外のMP3の再生にも対応しています。グラフィックスのサンプルプログラムであるdevkit/sample/graphic/stars/をベースにMP3ファイルによるBGMを再生します。ループ再生、再生停止、一時停止、ID3タグの読み飛ばし処理の参考にしてください。また、ID3タグの解析による主要な音楽情報(トラック名、アーティスト名など)の取得も行っています。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_2">
<h2>
 2 <!-- hp --><b>使用手順の概略</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_2_1">
<h3>
<a href="#Heading3_2"> 2. </a>1 
<!-- hp1 --><b>vaudioの使用手順</b><br>
</a>
</h3>
<div style="margin-left:50px;">vaudioを使用する前に、まずモジュールユーティリティ<a href="../utility/Utility-Reference-Japanese.htm#sceUtilityLoadModule">sceUtilityLoadModule</a>()により、vaudioモジュールをロードします。その後、以下のような手順にて利用することができます。<br><br></div>
</ul>
<div style="margin-left:55px;"><ol>
<li VALUE=1> <a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioChReserve">sceVaudioChReserve</a>()にて初期化処理を行います。</li>
<li VALUE=2> <a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioOutputBlocking">sceVaudioOutputBlocking</a>()などでサウンド出力処理を行います。</li>
<li VALUE=3> <a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioChRelease">sceVaudioChRelease</a>()にて終了処理を行います。</li>
</ol></div>
<div style="margin-left:50px;"><br>vaudioで音声を出力するには、<a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioChReserve">sceVaudioChReserve</a>()関数によりオーディオ出力機能の使用を宣言するとともに、一度に出力するデータの出力サンプル長、データのサンプリングレートを設定します。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>例)
int iRc;

/* 一度に256サンプルずつ出力する */
iRc = <a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioChReserve">sceVaudioChReserve</a>(256,44100,<a href="../sound/Vaudio-Reference-Japanese.htm#SCE_VAUDIO_FMT_S16_STEREO">SCE_VAUDIO_FMT_S16_STEREO</a>);
if (iRc != SCE_OK){
	/* 設定に失敗した */
}
</font></pre></div>
<div style="margin-left:50px;"><br>実際のサウンド出力には<a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioOutputBlocking">sceVaudioOutputBlocking</a>()関数を利用します。<a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioOutputBlocking">sceVaudioOutputBlocking</a>()は、指定されたバッファに格納されているPCM形式の音声データをオーディオドライバに登録します。登録されたサウンドデータは、既にオーディオドライバに登録されていたサウンドデータが再生された後に再生が開始されます。また、再生が開始されるまでこの関数を呼び出したスレッドはwait状態になります。<br>オーディオドライバに登録したからといって即座に再生が行われるとは限りません。また関数から戻ってきた時点で、登録したサウンドデータの再生は開始されていますが、終了しているわけではありませんし、そのデータがどこかにコピーされているわけでもありません。そのため実際に再生が終了するまでにバッファの内容を書き換えてしまうと正しく再生されません。サウンド出力用バッファはダブルバッファ以上にし、登録直後のバッファ内容を書き換えてしまわないようにしてください。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>例)
/* pcmBuf はダブルバッファとする */
int iSide = 0;

/* pcmBuf[iSide] にある 16 bit PCM STEREOデータを出力する */
<a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioOutputBlocking">sceVaudioOutputBlocking</a>(
	<a href="../sound/Vaudio-Reference-Japanese.htm#SCE_VAUDIO_VOLUME_0dB">SCE_VAUDIO_VOLUME_0dB</a>,
	pcmBuf[iSide]
);
iSide ^= 1;
</font></pre></div>
<div style="margin-left:50px;"><br>同様の注意が終了時にも必要となります。PCMデータを動的に確保したメモリ領域(malloc関数で確保した領域や、関数内部で確保される自動変数など)においていた場合、該当データの出力が終了する前にメモリ領域を開放してしまうと、実行するときの状況によって異なる雑音が出力される可能性があります。「最後のデータ」の出力が確実に終了していることを確認してから、メモリの開放などを行うようにしてください。また、PCM形式のサウンド出力には、専用のスレッドを用いることが多いですが、そのような場合、サウンド出力スレッドがまだデータを出力している最中にスレッドを強制終了するようなことがない様に、スレッド間の同期を取って処理を行うようにしてください(詳しくはサンプルプログラムをご覧ください)。<br><br>再生を行っている最中(あるいは再生の前)に<a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioSetAlcMode">sceVaudioSetAlcMode</a>()関数を呼び出すと、自動音量調整機能の有効・無効を切り替えることができます。また同様に、<a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioSetEffectType">sceVaudioSetEffectType</a>()関数を呼び出すことで、イコライザのモードを切り替えることができます。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>例)
<a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioSetAlcMode">sceVaudioSetAlcMode</a>(<a href="../sound/Vaudio-Reference-Japanese.htm#SCE_VAUDIO_ALC_MODE1">SCE_VAUDIO_ALC_MODE1</a>);
<a href="../sound/Vaudio-Reference-Japanese.htm#sceVaudioSetEffectType">sceVaudioSetEffectType</a>(<a href="../sound/Vaudio-Reference-Japanese.htm#SCE_VAUDIO_FX_TYPE_UNIQUE">SCE_VAUDIO_FX_TYPE_UNIQUE</a>);
</font></pre></div>
<div style="margin-left:50px;"><br></div>

<!-- sce_hd3 -->
<a name="Heading3_3">
<h2>
 3 <!-- hp --><b>注意事項</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">vaudioは内部でエフェクト処理などを行った後、simple audioライブラリが使用しているのと同じブロックを使って最終的な音声出力を行ないます。このため、simple audioとvaudioを同時に使用することはできません。同時に使用しようとすると、チャネルを初期化する際にエラーが返ります。<br><br>またsimple audioと同様に、出力したデータは32bitバス上からアクセスできる場所にある必要があります。DDRメモリ上に置くようにしてください。<br><br>イコライザを使用した場合、デジタル領域でクリッピングが発生し、ノイズが聞こえることがあります。これは、イコライザにより特定周波数帯域の音声が強調された結果、振幅が大きくなってしまうためです。発生する確度は低いですが、サンプリングレート変換を使用したときも同様の問題が起きることがあります。入力波形を余裕を持って小さめにしておくことで回避してください。<br><br>vaudioで44.1kHz以外のサンプリングレートの音声を再生する場合、内部で44.1kHzに変換されてから、vaudio以外の音声出力とミキシングされます。したがって、48kHzでサンプリングされた音声を再生しても、22.05kHz以上の周波数成分は出力されません。<br><br></div>
<p><p><hr>
<div ALIGN="right">
    &copy;2008 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
