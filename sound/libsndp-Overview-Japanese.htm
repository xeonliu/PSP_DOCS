<html lang="jp">
<head>
<title>libsndp-Overview</title>
<meta http-equiv="Content-Type" content= text/html; charset=Shift_JIS>
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="Text/css>
<meta name="Author"Content=" Sony Computer Entertainment Inc.">
</head>
<body bgcolor="#ffffff" text="#000000" >
<a name=TOP></a>
<table WIDTH="100%">
<tr><td>
<h3>PSP&reg; Programmer Tool Runtime Library Release 6.6.0</h3>
</td>
</tr>
</table>
<hr noshade size=6>
<center><h1>
libsndp
</h1></center>
</a>
<!-- sce_hd1 -->
<div style="margin-left:67px;"><br></div>

<!-- sce_hd3 -->
<a name="Heading3_1">
<h2>
 1 <!-- hp --><b>概要</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_1_1">
<h3>
<a href="#Heading3_1"> 1. </a>1 
<!-- hp1 --><b>仕様</b><br>
</a>
</h3>
<div style="margin-left:50px;">libsndpはPSP&reg;専用サウンドアーティストツールで作成したサウンドデータを使用するためのサービスです。<br>ボイス管理システムとSMF（スタンダードMIDIファイル）シーケンサ機能も当ライブラリに含まれます。<br>当ライブラリはlibsas上に構成され、動作はSASでの1粒度時間を基本とします。<br>1粒度時間は通常256サンプルですが（<a href="../sound/libsndp-Reference-Japanese.htm#sceSsInit">sceSsInit</a>()で初期化した場合）、1粒度時間を指定することもできます（<a href="../sound/libsndp-Reference-Japanese.htm#sceSsInitWithGrain">sceSsInitWithGrain</a>()で初期化した場合）。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_2">
<h3>
<a href="#Heading3_1"> 1. </a>2 
<!-- hp1 --><b>フロー概略</b><br>
</a>
</h3>
<div style="margin-left:50px;">libsndpのフロー概略を下記の図に示します。<br><br></div>

<div align=center>
<p>
<img src="gif/libsndp-Overview-Japanese001.gif">
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>図 1  libsndpのフロー概略</b><br>
</div>
<br>
<div style="margin-left:50px;"><br>libsndpは受け付けたコマンドの実質的な処理を<a href="../sound/libsndp-Reference-Japanese.htm#sceSsSynthesis">sceSsSynthesis</a>()内で一括処理します。<a href="../sound/libsndp-Reference-Japanese.htm#sceSsSynthesis">sceSsSynthesis</a>()は処理した内容を反映させた波形を指定された波形出力バッファに出力します。<br>処理単位は1粒度のサンプル数となりますので、受け付けたコマンドの前後関係はすべて出力波形の冒頭で揃えられます。<br>SMFシーケンサ内の処理は<a href="../sound/libsndp-Reference-Japanese.htm#sceSsSynthesis">sceSsSynthesis</a>()内で1粒度時間分消化され、時間内のシーケンス結果もすべて出力波形の冒頭で揃います。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_3">
<h3>
<a href="#Heading3_1"> 1. </a>3 
<!-- hp1 --><b>関連ファイル</b><br>
</a>
</h3>
<div style="margin-left:50px;">libsndpに関連するファイルは以下のとおりです。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>カテゴリ</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>ファイル名</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;ライブラリファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;libsndp.a&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;ライブラリヘッダファイル&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;libsndp.h&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;phdデータヘッダ&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;sdphd.h&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_hd4 -->
<a name="Heading4_1_4">
<h3>
<a href="#Heading3_1"> 1. </a>4 
<!-- hp1 --><b>ライブラリ構成</b><br>
</a>
</h3>
<div style="margin-left:50px;">libsndpは下記の構成になります。<br>libsndpはPHDからパラメータを取得し、libsas関数を用いて処理をする機能を有します。<br><br></div>

<div align=center>
<p>
<img src="gif/libsndp-Overview-Japanese002.gif">
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>図 2  libsndpの構成</b><br>
</div>
<br>

<!-- sce_hd4 -->
<a name="Heading4_1_5">
<h3>
<a href="#Heading3_1"> 1. </a>5 
<!-- hp1 --><b>参考資料</b><br>
</a>
</h3>
<div style="margin-left:50px;">libsndpが使用するサウンドデータ（PHD/PBD）の詳細はドキュメント「サウンドデータフォーマット」をご参照ください。<br>また、SMFの詳細は市販の規格解説書をご参照ください。<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_2">
<h2>
 2 <!-- hp --><b>機能</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_2_1">
<h3>
<a href="#Heading3_2"> 2. </a>1 
<!-- hp1 --><b>ボイス管理システム</b><br>
</a>
</h3>
<div style="margin-left:50px;">libsndpは限られたボイスを有効に活用する為に、最も適したボイスを自動でアサインする為のシステムを有しています。具体的には、<a href="../sound/libsndp-Reference-Japanese.htm#sceSsNoteOn">sceSsNoteOn</a>(), <a href="../sound/libsndp-Reference-Japanese.htm#sceSsKeyOnByTone">sceSsKeyOnByTone</a>(), <a href="../sound/libsndp-Reference-Japanese.htm#sceSsNoteOnByTone">sceSsNoteOnByTone</a>()を使って発音を行う場合に、ボイス管理システムを使いボイスを割り振ります。<br>基本的には発音していないボイスを割り振りますが、すべてのボイスが使用されている状況下においては、PHDにて設定された優先度を基準に、割り当てるのに最も適した状態のボイスから割り当てるのが基本的な動作となります。<br></div>
<br>
<div style="margin-left:50px;">判断基準の一つであるボイスの状態を、割り当てられる優先度の高い順に列挙します。<br>ボイスの状態はlibsndp関数である<a href="../sound/libsndp-Reference-Japanese.htm#sceSsVoiceGetStatus">sceSsVoiceGetStatus</a>()で参照可能です。<br></div>
<br>
<div style="margin-left:50px;">各状態の詳細は関数リファレンスを参照してください。<br></div>
<br>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>状態</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>優先度</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;SCE_SNDP_VOICESTATUS_IDLE&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;高&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;SCE_SNDP_VOICESTATUS_RELEASE&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;&uarr;&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;SCE_SNDP_VOICESTATUS_SUSTAIN&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;SCE_SNDP_VOICESTATUS_BUSY&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;&darr;&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;SCE_SNDP_VOICESTATUS_NOTEON&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;低&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;">この際、候補となる状態の中のすべてのボイスのプライオリティが、新たな発音のプライオリティより高い場合次の状態へと順に検索し、すべてのボイスが新たな発音のプライオリティより高い場合、発音は行われません。<br><br>PHDのトーンパラメータgroupは同一グループの排他発音機能を提供します。トーンパラメータのgroupに0以外の値を設定し発音した場合、既に同じgroup値のトーンがあれば発音を停止して新たな発音を開始します。group値が0ならグループ機能はオフです。<br><br>ボイスに対して発行された発音開始・停止コマンドによるステータスの変更は、各コマンド内で行われます。ただし、<a href="../sound/libsndp-Reference-Japanese.htm#sceSsSynthesis">sceSsSynthesis</a>()の結果、終了したボイスがあればIDLE状態に遷移します。<br>同一ボイスに対し、発音・サスティン＝オン・発音停止のプロセスでは発音停止コマンド内でサスティン状態に遷移します。サスティン状態のボイスに対し発音停止をした場合は、RELEASE状態に遷移します。<br>発音・発音停止（サスティン状態オフ）・<a href="../sound/libsndp-Reference-Japanese.htm#sceSsSynthesis">sceSsSynthesis</a>()の場合は、<a href="../sound/libsndp-Reference-Japanese.htm#sceSsSynthesis">sceSsSynthesis</a>()では発音しません。<br><br>同一ボイスに対して発行したコマンドは<a href="../sound/libsndp-Reference-Japanese.htm#sceSsSynthesis">sceSsSynthesis</a>()直前の状態が有効となります。<br>ボイス管理システムはボイスに対し発行されたコマンド状態もボイス割り当て条件に含めSASの挙動に最も適した状態を維持します。<br>ただし、直接ボイス指定で発音を行った場合は、指定したボイスを使用しますのでこの限りではありません。<br><br>また、<a href="../sound/libsndp-Reference-Japanese.htm#sceSsVoiceSetReserveMode">sceSsVoiceSetReserveMode</a>()によりボイスをlibsndpの管理下から外した場合、ボイスの状態はSCE_SNDP_VOICESTATUS_RESERVEDになり、そのボイスに対してボイスアサインを行わなくなります。<a href="../sound/libsndp-Reference-Japanese.htm#sceSsVoiceSetPause">sceSsVoiceSetPause</a>()によりポーズ状態になっているボイスも、ボイスアサインの対象外になります。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_2">
<h3>
<a href="#Heading3_2"> 2. </a>2 
<!-- hp1 --><b>発音と操作</b><br>
</a>
</h3>
<div style="margin-left:50px;">libsndpにて操作できる発音操作では、発音内容を識別する為にキーオンIDを設定する必要があります。<br><br>これは同じトーンパラメータによる発音や、ノート・オンによる発音に於いて、同一の内容で発音しても、個々の発音を分離して操作したい場合に元の発音を明確にする為です。<br><br>たとえば同じトーンパラメータで3つのオブジェクトA・B・Cが発音を行い、Aの発音だけ定位を変更したい場合に、A・B・Cで異なるキーオンIDを割り振る事で、キーオンIDから発音ボイスを特定し、そのボイスに対して操作する事で分離した操作を可能にしています。<br><br>ただし、キーオンIDの内0x80000000〜0xFFFFFFFFはlibsndpでの予約です。<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_3">
<h3>
<a href="#Heading3_2"> 2. </a>3 
<!-- hp1 --><b>SMF（スタンダードMIDIファイル）シーケンサ</b><br>
</a>
</h3>
<div style="margin-left:50px;">libsndpは内部にSMF（スタンダードMIDIファイル）シーケンサ機能を含んでいます。<br><br>SMFシーケンサは同時に複数の演奏が可能ですが、MIDIイベントが同一粒度内に大量に含まれる場合は遅延発生の原因となりますので注意してください。<br>SMFシーケンサで無視されるイベントは削除される事と、同一粒度内での大量のイベントは適宜時間をずらす事をお勧めします。<br><br>libsbdpはSASでの1粒度時間を基準といたしますので、60BPMの場合の分解能は約172となります。微細な音符を含むSMFを早いテンポで再生した場合はクォンタイズされます。<br><br>コントロールチェンジやピッチベンドにての操作は粒度時間最後の内容が有効となりますので、特にピッチ操作やボリューム操作での値の最終値による変化が急激になった場合、ノイズ発生の原因となるのでこの点に注意してください。<br><br>SMFシーケンサは対応しているMIDIイベントのみ動作し、対応していないMIDIイベントは無視します。<br><br>以下は対応イベントです。<br><br></div>
<div style="margin-left:40px;"><ul>
<li> ノート・オフ（8nH）
<li> ノート・オン（9nH）
<li> コントロールチェンジ（BnH）<br>チャンネル・ボリューム（旧メイン・ボリューム）（07H）<br>パンポット（0AH)<br>エクスプレッション・コントローラ（0BH）<br>ホールド（ダンパー・ペダル、サスティン）（40H）<br>データ・エントリ（MSB）（06H）<br>NRPN（MSB）（63H）
<li> プログラムチェンジ（CnH）
<li> ピッチ・ベンド・チェンジ（EnH）
</ul></div>
<div style="margin-left:50px;"><br>なお、以下はNRPNで使用可能な内容です。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>NRPN</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>機能</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;B0H,63H,00H&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;ループスタート設定&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;B0H,06H,nnH&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;ループ回数設定（nn = 00hの場合、無限ループ）&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;B0H,63H,01H&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;ループエンド設定&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;">ループ設定は、ループスタート設定からループエンド設定の間に必ずループ回数設定をする必要があります。ループは複数設定可能ですが、入れ子構造は不可です。<br>ループエンド設定より前に複数のループスタート設定がある場合、最後のループスタート設定が有効となります。<br>また、ループ回数が設定されることなくループエンド設定された場合、ループしません。<br><br>初回の発音を確実にするため、最初のノート・オンイベントの前にプログラムチェンジが含まれているかを必ず確認してください。<br></div>
<p><p><hr>
<div ALIGN="right">
    &copy;2011 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
