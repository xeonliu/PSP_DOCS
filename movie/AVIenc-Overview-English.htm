<html lang="en">
<head>
<title>AVIenc-Overview</title>
<meta http-equiv="Content-Type" content= text/html; charset=iso-8859-1>
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="Text/css>
<meta name="Author"Content=" Sony Computer Entertainment Inc.">
</head>
<body bgcolor="#ffffff" text="#000000" >
<a name=TOP></a>
<table WIDTH="100%">
<tr><td>
<h3>PSP&trade; Programmer Tool Runtime Library Release 6.3.0</h3>
</td>
</tr>
</table>
<hr noshade size=6>
<center><h1>
AVI Encoding Overview
</h1></center>
</a>
<!-- sce_hd1 -->

<!-- sce_hd3 -->
<a name="Heading3_1">
<h2>
 1 <!-- hp --><b>Library Overview</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_1_1">
<h3>
<a href="#Heading3_1"> 1. </a>1 
<!-- hp1 --><b>Function Overview and Features</b><br>
</a>
</h3>
<div style="margin-left:50px;">The AVI encoding library provides functions for combining Motion JPEG video and linear PCM or u-law PCM-formatted audio into a single file to encode a movie.<br></div>

<!-- sce_hd4 -->
<a name="Heading4_1_2">
<h3>
<a href="#Heading3_1"> 1. </a>2 
<!-- hp1 --><b>Features</b><br>
</a>
</h3>
</ol>
<div style="margin-left:40px;"><ul>
<li> Supports AVI 1.0.
<li> Motion JPEG can be used for video, and linear PCM or u-law PCM format can be used for audio.
</ul></div>

<!-- sce_hd4 -->
<a name="Heading4_1_3">
<h3>
<a href="#Heading3_1"> 1. </a>3 
<!-- hp1 --><b>Related Files</b><br>
</a>
</h3>
<div style="margin-left:50px;">The following files are required to use the AVI encoding library.<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Category</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>File Name</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;Static link library file&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;libavienc.a&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;Header file&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;avienc.h&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_hd4 -->
<a name="Heading4_1_4">
<h3>
<a href="#Heading3_1"> 1. </a>4 
<!-- hp1 --><b>Sample Program</b><br>
</a>
</h3>

<!-- sce_title -->
<a Name ="HeadingT_1_4_1">
<div style="margin-left:40px;"><h4><b>devkit/sample/avi/avi_wrapper</b><br><br></h4></div></a>

<div style="margin-left:67px;">This directory contains sample source code that shows how to use libraries such as avienc, jpegenc, fmacvideo, or u-law to create an AVI (motion JPEG) movie. The samples under devkit/sample/avi use the source header found here. For details, refer to the readme in each sample.<br>By studying the source code, you can understand the processing flow involved in creating a movie. This includes encoding the contents of the frame buffer as Motion JPEG, encoding PCM waveform data as u-law compressed data, etc. and then merging the encoded results into an AVI file, and saving it on flash media.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_4_2">
<div style="margin-left:40px;"><h4><b>devkit/sample/avi/avi_wrap_template</b><br><br></h4></div></a>

<div style="margin-left:67px;">This directory contains a header template that you can use for including the source and header located under avi_wrapper in a title application. Copy this template into your title application and change it as necessary according to your title's specifications.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_4_3">
<div style="margin-left:40px;"><h4><b>devkit/sample/avi/rec_simple</b><br><br></h4></div></a>

<div style="margin-left:67px;">This sample adds a silent movie recording feature to the simple graphics sample program devkit/sample/graphics/simple.<br>Only main.c was changed to add the movie recording feature (the Makefile must also be changed accordingly for the environment).<br>By looking at the differences between this sample program and devkit/sample/graphics/simple, you can see where the changes were made.<br>Use this as a reference for recording digital movies of materials for promotional videos.<br>Note that silent AVI is not supported by system software.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_4_4">
<div style="margin-left:40px;"><h4><b>devkit/sample/avi/rec_at3mix</b><br><br></h4></div></a>

<div style="margin-left:67px;">This sample adds a movie recording feature to the sound and graphics sample program devkit/sample/sound/at3mix.<br>Only main.c and soundthread.* were changed to add the movie recording feature (the Makefile also must be changed accordingly for the environment).<br>By looking at the differences between this sample program and devkit/sample/sound/at3mix, you can see where the changes were made.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_4_5">
<div style="margin-left:40px;"><h4><b>devkit/sample/avi/rec_p3da_revolve</b><br><br></h4></div></a>

<div style="margin-left:67px;">This sample adds a movie recording feature to the 3D audio sample program devkit/sample/sound/p3da_revolve.<br>Only main.c and sound.* were changed to add the movie recording feature (the Makefile must also be changed accordingly for the environment).<br>Note: key.* was also changed separately from the movie recording feature.<br>By looking at the differences between this sample program and devkit/sample/sound/p3da_revolve, you can see where the changes were made.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_4_6">
<div style="margin-left:40px;"><h4><b>devkit/sample/avi/rec_starmix</b><br><br></h4></div></a>

<div style="margin-left:67px;">This sample adds a movie recording feature to the sound and graphics sample program devkit/sample/sound/starmix.<br>Only main.c and at3plus.* were changed to add the movie recording feature (the Makefile must also be changed accordingly for the environment).<br>By looking at the differences between this sample program and devkit/sample/sound/starmix, you can see where the changes were made.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_4_7">
<div style="margin-left:40px;"><h4><b>devkit/sample/avi/rec_at3doubleplay</b><br><br></h4></div></a>

<div style="margin-left:67px;">This sample adds a movie recording feature to the sound and graphics sample program devkit/sample/sound/at3doubleplay.<br>This sample is an applied version. You should refer to a different sample to learn about basic features of AVI movie recording.<br>This sample uses a simple replay function to save controller information and perform movie recording as replay recording. BGM is played separately during movie recording.<br></div>

<!-- sce_hd3 -->
<a name="Heading3_2">
<h2>
 2 <!-- hp --><b>Overview of the Usage Procedure</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">The following procedure can be used for encoding.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_1"><h4>
(1)&nbsp;<b>Prepare user-defined file access functions to be used with the AVI encoding library</b><br></h4>
</a></div>
<div style="margin-left:67px;">Create wrapper functions for accessing files. Although there are three types of file access functions, read, write, and seek, a read function does not need to be prepared because it is not used by the encoding library.<br>Also, a file cannot be left open when it is written to a Memory Stick&trade;. Use the flash media access video library, which is included in the runtime library package.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_2"><h4>
(2)&nbsp;<b>Assign a file where the AVI encoded data will be output</b><br></h4>
</a></div>
<div style="margin-left:67px;">Before performing AVI encoding, temporarily create an AVI video header and make preparations for outputting the data.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_3"><h4>
(3)&nbsp;<b>Initialize the encoder</b><br></h4>
</a></div>
<div style="margin-left:67px;">Initialize the AVI operation structure by calling the initialization function <a href="../movie/AVIenc-Reference-English.htm#sceAviInitInfo">sceAviInitInfo</a>() and passing a pointer to the AVI encoding work area. Set any parameter that is not used to NULL.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_4"><h4>
(4)&nbsp;<b>Configure the encoder</b><br></h4>
</a></div>
<div style="margin-left:67px;">Use functions such as <a href="../movie/AVIenc-Reference-English.htm#sceAviSimpleVideoHeader">sceAviSimpleVideoHeader</a>() to configure video settings, <a href="../movie/AVIenc-Reference-English.htm#sceAviSimpleAudioHeader">sceAviSimpleAudioHeader</a>() to configure audio settings, and <a href="../movie/AVIenc-Reference-English.htm#sceAviComposeWriteDummyHeader">sceAviComposeWriteDummyHeader</a>() to output a dummy header to the file.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5"><h4>
(5)&nbsp;<b>Start encoding</b><br></h4>
</a></div>
<div style="margin-left:67px;">Use <a href="../movie/AVIenc-Reference-English.htm#sceAviComposeResetRate">sceAviComposeResetRate</a>() to start recording at the data rate.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_6"><h4>
(6)&nbsp;<b>Encode the data</b><br></h4>
</a></div>
<div style="margin-left:67px;">Use <a href="../movie/AVIenc-Reference-English.htm#sceAviComposePutEntry">sceAviComposePutEntry</a>() to output audio and video to the file. Check the file size by using <a href="../movie/AVIenc-Reference-English.htm#sceAviComposeStopRate">sceAviComposeStopRate</a>() or <a href="../movie/AVIenc-Reference-English.htm#sceAviComposeResetRate">sceAviComposeResetRate</a>() every second to verify the bitrate.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_7"><h4>
(7)&nbsp;<b>End processing</b><br></h4>
</a></div>
<div style="margin-left:67px;">Call <a href="../movie/AVIenc-Reference-English.htm#sceAviComposeStopRate">sceAviComposeStopRate</a>() to terminate data rate recording. Use <a href="../movie/AVIenc-Reference-English.htm#sceAviComposeWriteIndexes">sceAviComposeWriteIndexes</a>() to output indexes and <a href="../movie/AVIenc-Reference-English.htm#sceAviComposeFinishRiff">sceAviComposeFinishRiff</a>() to output a formal header to the file.<br>Call <a href="../movie/AVIenc-Reference-English.htm#sceAviComposeFinish">sceAviComposeFinish</a>() to end processing.<br><br></div>
<div style="margin-left:50px;">Perform appropriate error checking for each function call.<br><br></div>

<!-- sce_hd3 -->
<a name="Heading3_3">
<h2>
 3 <!-- hp --><b>Precautions</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_3_1">
<h3>
<a href="#Heading3_3"> 3. </a>1 
<!-- hp1 --><b>File Operations</b><br>
</a>
</h3>
<div style="margin-left:50px;">A file cannot be left open when it is written to a Memory Stick&trade;. Use the flash media access video library, which is included in the runtime library package.<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_2">
<h3>
<a href="#Heading3_3"> 3. </a>2 
<!-- hp1 --><b>Silent AVI</b><br>
</a>
</h3>
<div style="margin-left:50px;">Silent AVI is not supported by system software. Note that it will be treated as "corrupted data."<br>Although you can use silent AVI in materials for promotional videos or the like, be sure the production version supports AVI movie recording with audio.<br><br></div>
<p><p><hr>
<div ALIGN="right">
    &copy;2009 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
