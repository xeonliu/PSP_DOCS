<html lang="en">
<head>
<title>libface-Overview</title>
<meta http-equiv="Content-Type" content= text/html; charset=iso-8859-1>
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="Text/css>
<meta name="Author"Content=" Sony Computer Entertainment Inc.">
</head>
<body bgcolor="#ffffff" text="#000000" >
<a name=TOP></a>
<table WIDTH="100%">
<tr><td>
<h3>PSP&trade; Programmer Tool Runtime Library Release 6.3.0</h3>
</td>
</tr>
</table>
<hr noshade size=6>
<center><h1>
libface Overview
</h1></center>
</a>
<!-- sce_hd1 -->

<!-- sce_hd3 -->
<a name="Heading3_1">
<h2>
 1 <!-- hp --><b>Library Overview</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_1_1">
<h3>
<a href="#Heading3_1"> 1. </a>1 
<!-- hp1 --><b>Function Overview and Features</b><br>
</a>
</h3>
<div style="margin-left:50px;">libface is a library for analyzing grayscale images and recognizing the faces of people whose pictures appear in those images. The following functions are provided by libface.<br></div>
</ol>
<div style="margin-left:40px;"><ul>
<li> Detect a face (or faces) in a grayscale image
<li> Detect the eyes, nose and mouth of a detected face
<li> Determine the degree to which a detected face is smiling
</ul></div>
<div style="margin-left:50px;">The following terms are used in libface.<br></div>
<div style="margin-left:40px;"><ul>
<li> Face recognition: <br>Overall recognition of faces in an image. In libface, face recognition includes face detection, parts detection, and the discrimination of face attributes.
<li> Face detection: <br>Detection of face regions within an image.
<li> Parts detection: <br>Detection of the eyes, nose and mouth from detected face regions.
<li> Face attribute discrimination: <br>Determination of the degree of smile from detected face regions.
</ul></div>

<!-- sce_hd4 -->
<a name="Heading4_1_2">
<h3>
<a href="#Heading3_1"> 1. </a>2 
<!-- hp1 --><b>Related Files</b><br>
</a>
</h3>
<div style="margin-left:50px;">The following files are required to use libface.<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Filename</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Description</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;libface.h&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Header file&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;libface_stub.a&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Stub library file&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;libface_stub_weak.a&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;weak import stub library file&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;">The following face detection dictionary data files are used by libface.<br>These files are located in devkit/data/or_dict/face/.<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td bgcolor="#cccccc" valign="top">&nbsp;<b>Filename</b>&nbsp;</td>
<td bgcolor="#cccccc" valign="top">&nbsp;<b>Description</b>&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;face_detect_frontal.fdt&nbsp;</td>
<td valign="top">&nbsp;Face&nbsp;detection&nbsp;dictionary&nbsp;data&nbsp;file&nbsp;(for&nbsp;frontal&nbsp;face)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;face_detect_frontal_fast.fdt&nbsp;</td>
<td valign="top">&nbsp;Face&nbsp;detection&nbsp;dictionary&nbsp;data&nbsp;file&nbsp;(fast&nbsp;version&nbsp;for&nbsp;frontal&nbsp;face)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;face_detect_roll.fdt&nbsp;</td>
<td valign="top">&nbsp;Face&nbsp;detection&nbsp;dictionary&nbsp;data&nbsp;file&nbsp;(roll&nbsp;support)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;face_detect_roll_yaw.fdt&nbsp;</td>
<td valign="top">&nbsp;Face&nbsp;detection&nbsp;dictionary&nbsp;data&nbsp;file&nbsp;(roll&nbsp;and&nbsp;yaw&nbsp;support)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;face_detect_roll_yaw_pitch.fdt&nbsp;</td>
<td valign="top">&nbsp;Face&nbsp;detection&nbsp;dictionary&nbsp;data&nbsp;file&nbsp;(roll,&nbsp;yaw,&nbsp;and&nbsp;pitch&nbsp;support)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;face_parts_frontal_roll.pdt&nbsp;</td>
<td valign="top">&nbsp;Parts&nbsp;detection&nbsp;dictionary&nbsp;data&nbsp;file&nbsp;(frontal&nbsp;face&nbsp;with&nbsp;roll&nbsp;support)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;face_parts_roll_yaw.pdt&nbsp;</td>
<td valign="top">&nbsp;Parts&nbsp;detection&nbsp;dictionary&nbsp;data&nbsp;file&nbsp;(roll&nbsp;and&nbsp;yaw&nbsp;support)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;face_attrib_smile.adt&nbsp;</td>
<td valign="top">&nbsp;Attribute&nbsp;discrimination&nbsp;dictionary&nbsp;data&nbsp;file&nbsp;<br>&nbsp;(degree&nbsp;of&nbsp;smile)&nbsp;</td>
</tr></table>
</div>
<br>

<!-- sce_hd4 -->
<a name="Heading4_1_3">
<h3>
<a href="#Heading3_1"> 1. </a>3 
<!-- hp1 --><b>Sample Programs</b><br>
</a>
</h3>
<div style="margin-left:50px;">The following libface sample programs are available for your reference.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_3_1">
<div style="margin-left:40px;"><h4><b>devkit/sample/face/face_tracking</b><br><br></h4></div></a>

<div style="margin-left:67px;">This is a sample application that uses libface. It performs face detection in realtime for images input from the camera and displays the applied results on the screen. It uses the face detection result of the previous frame to detect faces quickly.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_3_2">
<div style="margin-left:40px;"><h4><b>devkit/sample/face/simple_face</b><br><br></h4></div></a>

<div style="margin-left:67px;">This is a sample used for demonstrating face detection, parts detection, and attribute discrimination in libface. It performs a series of face recognition processes for images input from the camera and displays face recognition results on the screen.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_3_3">
<div style="margin-left:40px;"><h4><b>devkit/sample/face/simple_face_my_malloc</b><br><br></h4></div></a>

<div style="margin-left:67px;">This is a sample showing how to use the libface memory management API. It performs the same processing as the simple_face sample but calls user-defined memory management functions internally from the libface library.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_1_3_4">
<div style="margin-left:40px;"><h4><b>Notes on the Samples</b><br><br></h4></div></a>

<div style="margin-left:67px;">The samples perform face recognition of input images for the USB camera for PSP&trade; in self-portrait mode (motion JPEG), so they should be run with the camera facing the PSP&trade; operator.<br><br>Assuming that the input image from the camera will be used only for face recognition, to achieve extremely fast performance the camera should be set to the lowest resolution QQVGA (160x120). The smaller the image size, the less the possibility of a data cache miss and the faster the entire program will run, including face recognition.<br>If the camera is set to high resolution, the image size, memory consumption and processing time will all increase.<br><br>Since a grayscale image is required for face recognition, faster processing can be achieved by using <a href="../still/JPEGDEC-Reference-English.htm#sceJpegDecodeMJpegYCbCr">sceJpegDecodeMJpegYCbCr</a>() to convert the JPEG data input from the camera to YCbCr format and then by directly having libface use the Y-image at the beginning of that data. The <a href="../still/JPEGDEC-Reference-English.htm#sceJpegMJpegCsc">sceJpegMJpegCsc</a>() function in each sample is only called to obtain RGBA images for screen display and is not used for face recognition.<br>If <a href="../still/JPEGDEC-Reference-English.htm#sceJpegDecodeMJpeg">sceJpegDecodeMJpeg</a>() is used to decode the JPEG data directly and convert it to RGBA format, RGBA-&gt;Y conversion will be required to obtain the grayscale image needed for face recognition.<br><br>A feature of self-portrait image detection is the assumption that a face shot will be large and near the center of the image. The parameters of the face recognition functions in the sample programs are set so that the programs run quickly under those image conditions, so only large faces in an image will be detected. If the parameters are set to detect small faces, the face detection time will increase.<br></div>

<!-- sce_hd3 -->
<a name="Heading3_2">
<h2>
 2 <!-- hp --><b>Overview of the Usage Procedure</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_2_1">
<h3>
<a href="#Heading3_2"> 2. </a>1 
<!-- hp1 --><b>Initialization Processing</b><br>
</a>
</h3>
<div style="margin-left:50px;">To use libface, you must call <a href="../image_recognition/libface-Reference-English.htm#sceFaceSetMallocFunction">sceFaceSetMallocFunction</a>() to set the memory management functions and perform initialization processing.<br>Since face detection dictionary data is required to execute face detection processing, it is recommended that the required face detection dictionary data files be read in advance as part of initialization.<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_2">
<h3>
<a href="#Heading3_2"> 2. </a>2 
<!-- hp1 --><b>Termination Processing</b><br>
</a>
</h3>
<div style="margin-left:50px;">libface has no termination function.<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_3">
<h3>
<a href="#Heading3_2"> 2. </a>3 
<!-- hp1 --><b>Memory Management Processing Procedure</b><br>
</a>
</h3>
<div style="margin-left:50px;"><a href="../image_recognition/libface-Reference-English.htm#sceFaceSetMallocFunction">sceFaceSetMallocFunction</a>() can be used to freely set dynamic memory allocation and free functions that will be used internally by the libface library. It must be called once before executing face recognition processing.<br><br></div>

<div align=center>
<p>
<img src="gif/libface-Overview-English001.gif">
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>Figure 1  Memory Management Processing Procedure</b><br>
</div>
<br>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_3_1"><h4>
(1)&nbsp;<b>Setting memory management functions</b><br></h4>
</a></div>
<div style="margin-left:67px;">Before you can execute face recognition processing in an application, you must call <a href="../image_recognition/libface-Reference-English.htm#sceFaceSetMallocFunction">sceFaceSetMallocFunction</a>() once.<br>Even you plan to use the standard library functions malloc() and free(), you still must call <a href="../image_recognition/libface-Reference-English.htm#sceFaceSetMallocFunction">sceFaceSetMallocFunction</a>() with malloc and free set for its arguments. User-defined malloc and free functions can also be set.<br>Since <a href="../image_recognition/libface-Reference-English.htm#sceFaceSetMallocFunction">sceFaceSetMallocFunction</a>() only sets function pointers, you may call it any number of times with the same arguments and no problems will occur, however, there is no reason to do this.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_3_2"><h4>
(2)&nbsp;<b>Executing face recognition processing</b><br></h4>
</a></div>
<div style="margin-left:67px;">Execute face recognition processing.<br>When an execution function for face detection, parts detection, or attribute discrimination is called, the memory allocation function set in (1) is called to allocate the required memory, then recognition processing is performed. When recognition processing finishes, the memory free function set in (1) is called to free the allocated memory, and finally the function returns.<br>If a face recognition processing function for face detection, parts detection, or attribute discrimination is called without first setting the memory management functions in (1), <a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_ERROR_NO_MEMORY">SCE_FACE_ERROR_NO_MEMORY</a> is returned for the return value and no face recognition processing is executed.<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_4">
<h3>
<a href="#Heading3_2"> 2. </a>4 
<!-- hp1 --><b>Face Detection Processing Procedure</b><br>
</a>
</h3>
<div style="margin-left:50px;">A grayscale image is required as the input data for face detection processing.<br>To execute face detection processing, select a face detection dictionary suitable for the application and pass a pointer to it in an argument. The face detection dictionary must be read into memory in advance from a face detection dictionary data file.<br></div>

<div align=center>
<p>
<img src="gif/libface-Overview-English002.gif">
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>Figure 2  Face Detection Processing Procedure</b><br>
</div>
<br>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_4_1"><h4>
(1)&nbsp;<b>Prepare the input image</b><br></h4>
</a></div>
<div style="margin-left:67px;">The input image for performing face recognition is an 8-bit grayscale image.<br></div>

<div align=center>
<p>
<img src="gif/libface-Overview-English003.gif">
</div>
<br>
<div style="margin-left:67px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>Figure 3  Input Image Width and Data Width</b><br>
</div>
<br>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_4_2"><h4>
(2)&nbsp;<b>Prepare the output area for the face detection result</b><br></h4>
</a></div>
<div style="margin-left:67px;">Prepare an array of <a href="../image_recognition/libface-Reference-English.htm#SceFaceDetectionResult">SceFaceDetectionResult</a> structures as the area for saving the output results from face detection. The number of elements in this array can be set as desired to match the number of faces to be detected. For example, when it is sufficient to detect a maximum of 10 persons' faces from one image, prepare a <a href="../image_recognition/libface-Reference-English.htm#SceFaceDetectionResult">SceFaceDetectionResult</a> structure array with 10 elements.<br></div>

<!-- sce_hd6 -->
<a name="Heading6_2_4_2_1">
<div style="margin-left:63px;"><h4><b>Note</b><br><br></h4></a></div>
<div style="margin-left:80px;">If the number of faces to be detected is limited further, memory will be conserved but it will still take the same amount of time for face detection.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_4_3"><h4>
(3)&nbsp;<b>Execute face detection</b><br></h4>
</a></div>
<div style="margin-left:67px;">Set the address of the face detection dictionary data, information about the input image, address of the face detection result output area, number of elements in the face detection result output array, and other face detection parameters as arguments and execute <a href="../image_recognition/libface-Reference-English.htm#sceFaceDetection">sceFaceDetection</a>().<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_4_4"><h4>
(4)&nbsp;<b>Receive the face detection results</b><br></h4>
</a></div>
<div style="margin-left:67px;">When <a href="../image_recognition/libface-Reference-English.htm#sceFaceDetection">sceFaceDetection</a>() completes successfully, the number of detected faces is returned in <i>numResultFace</i>. The individual face detection results are stored in each of the elements of the <a href="../image_recognition/libface-Reference-English.htm#SceFaceDetectionResult">SceFaceDetectionResult</a> structure array that was prepared in (2) and whose address was set in the argument <i>resultFaceArray</i>.<br>The face detection results include the face region position (<i>faceX, faceY</i>), size (<i>faceW, faceH</i>), and orientation (<i>faceRoll, facePitch, faceYaw</i>). The position and size are represented in a coordinate system in which the input image width and height are each 1.0, respectively.<br><br></div>

<div align=center>
<p>
<img src="gif/libface-Overview-English004.gif">
</div>
<br>
<div style="margin-left:67px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>Figure 4  Face Detection Results</b><br>
</div>
<br>
<div style="margin-left:67px;">The following code can be used to convert the face regions in the face detection results to coordinates in the input image.<br></div>
        <div style="margin-left:80px;"><pre><font size=3>
void rotate(int* ox, int *oy, int ix, int iy, int cx, int cy, float radian)
{
    const float c = cosf(radian);
    const float s = sinf(radian);
    ix -= cx;
    iy -= cy;
    *ox = (int)(ix * c - iy * s + cx);
    *oy = (int)(ix * s + iy * c + cy);
}

<a href="../image_recognition/libface-Reference-English.htm#SceFaceDetectionResult">SceFaceDetectionResult</a> face;
const int x1 = (int)( face.faceX * image_width);
const int y1 = (int)( face.faceY * image_height);
const int x2 = (int)((face.faceX + face.faceW) * image_width);
const int y2 = (int)((face.faceY + face.faceH) * image_height);
const int cx = (int)((face.faceX + face.faceW / 2) * image_width);
const int cy = (int)((face.faceY + face.faceH / 2) * image_height);
int face_top_left_x, face_top_left_y;  // pixel position
int face_top_right_x, face_top_right_y;  // pixel position
int face_bottom_left_x, face_bottom_left_y;  // pixel position
int face_bottom_right_x, face_bottom_right_y;  // pixel position

rotate(&amp;face_top_left_x, &amp;face_top_left_y, x1, y1, cx, cy, -face.faceRoll);
rotate(&amp;face_top_right_x, &amp; face_top_right_x, x2, y1, cx, cy, -face.faceRoll);
rotate(&amp;face_bottom_left_x, &amp;face_bottom_left_y, x1, y2, cx, cy, -face.faceRoll);
rotate(&amp;face_bottom_right_x, &amp;face_bottom_right_y, x2, y2, cx, cy, -face.faceRoll);
</font></pre></div>

<!-- sce_hd4 -->
<a name="Heading4_2_5">
<h3>
<a href="#Heading3_2"> 2. </a>5 
<!-- hp1 --><b>Parts Detection Processing Procedure</b><br>
</a>
</h3>
<div style="margin-left:50px;">To perform parts detection processing, the face detection results and the input image used for face detection are required as input data.<br>The processing flow is as follows. First, perform face detection processing. Then perform parts detection processing for each individual face in the face detection results. <br>To execute parts detection processing, select the parts detection dictionary suitable for the application and pass a pointer to it in an argument. The parts detection dictionary must be read into memory in advance from a parts detection dictionary data file.<br><br></div>

<div align=center>
<p>
<img src="gif/libface-Overview-English005.gif">
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>Figure 5  Parts Detection Processing Procedure</b><br>
</div>
<br>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5_1"><h4>
(1)&nbsp;<b>Execute face detection</b><br></h4>
</a></div>
<div style="margin-left:67px;">Prepare the input image and face detection result output area and execute face detection with the face detection parameters set as arguments. For details about the procedure, see the section "Face Detection Processing Procedure."<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5_2"><h4>
(2)&nbsp;<b>Prepare the parts detection result output area</b><br></h4>
</a></div>
<div style="margin-left:67px;">Prepare an array of <a href="../image_recognition/libface-Reference-English.htm#SceFacePartsResult">SceFacePartsResult</a> structures as the area for saving the output results from parts detection. This array must have <a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_PARTS_NUM_MAX">SCE_FACE_PARTS_NUM_MAX</a>(4) elements.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5_3"><h4>
(3)&nbsp;<b>Execute parts detection</b><br></h4>
</a></div>
<div style="margin-left:67px;">Execute <a href="../image_recognition/libface-Reference-English.htm#sceFaceParts">sceFaceParts</a>() and pass it the parts detection dictionary data address, information about the input image, face detection result obtained in (1), address of the parts detection result output area, number of elements in the parts detection result array, and other parts detection parameters as arguments.<br>For the input image, use the same image that was used for face detection processing. The image area must not be cleared until all parts detection processing has finished.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5_4"><h4>
(4)&nbsp;<b>Receive the parts detection results</b><br></h4>
</a></div>
<div style="margin-left:67px;">When <a href="../image_recognition/libface-Reference-English.htm#sceFaceParts">sceFaceParts</a>() completes successfully, the number of parts that were detected is returned in <i>numResultParts</i>. The detected positions of the right eye, left eye, nose and mouth are stored in the various elements of the <a href="../image_recognition/libface-Reference-English.htm#SceFacePartsResult">SceFacePartsResult</a> structure array prepared in (2) and whose address was set in the <i>resultPartsArray</i> argument. The type of part that was detected is stored in the <i>partsId</i> member of the <a href="../image_recognition/libface-Reference-English.htm#SceFacePartsResult">SceFacePartsResult</a> structure and the position of the part is stored in <i>partsX</i>, <i>partsY</i>. <i>partsX</i>, <i>partsY</i> are represented in a coordinate system in which the upper left corner of the face region within the face detection results is at (0.0, 0.0) and the lower right corner is at (1.0, 1.0).<br><br></div>

<div align=center>
<p>
<img src="gif/libface-Overview-English006.gif">
</div>
<br>
<div style="margin-left:67px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>Figure 6  Parts Detection Results</b><br>
</div>
<br>
<div style="margin-left:67px;">The following code can be used to convert the parts positions of the parts detection results to coordinates in the input image.<br></div>
        <div style="margin-left:80px;"><pre><font size=3>
<a href="../image_recognition/libface-Reference-English.htm#SceFaceDetectionResult">SceFaceDetectionResult</a> face;
<a href="../image_recognition/libface-Reference-English.htm#SceFacePartsResult">SceFacePartsResult</a> parts;
int parts_x_of_image = (face.faceX + face.faceW * parts.partsX) * image_width;
int parts_y_of_image = (face.faceY + face.faceH * parts.partsY) * image_height;
</font></pre></div>

<!-- sce_hd6 -->
<a name="Heading6_2_5_4_1">
<div style="margin-left:63px;"><h4><b>Note</b><br><br></h4></a></div>
<div style="margin-left:80px;">When the value stored in the <i>partsId</i> member of the <a href="../image_recognition/libface-Reference-English.htm#SceFacePartsResult">SceFacePartsResult</a> structure is <a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_PARTS_ID_UNDEF">SCE_FACE_PARTS_ID_UNDEF</a>, it means that parts detection or detailed parts detection processing failed.<br><br></div>
<div style="margin-left:67px;">When the right eye, left eye, nose and mouth are all detected by <a href="../image_recognition/libface-Reference-English.htm#sceFaceParts">sceFaceParts</a>(), the face angle (roll, pitch, yaw) can be estimated from the parts positions by executing <a href="../image_recognition/libface-Reference-English.htm#sceFaceEstimateAngle">sceFaceEstimateAngle</a>() with those parts detection results set as arguments.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_5_5"><h4>
(5)&nbsp;<b>Repeat the process for all faces</b><br></h4>
</a></div>
<div style="margin-left:67px;">Repeat the processing of (3) and (4) for all faces that were detected in (1).<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_6">
<h3>
<a href="#Heading3_2"> 2. </a>6 
<!-- hp1 --><b>Attribute Discrimination Processing Procedure</b><br>
</a>
</h3>
<div style="margin-left:50px;">To perform attribute discrimination processing, the face detection results, parts detection results and the input image used for face and parts detection are required as input data.<br>The processing flow is as follows. First, perform face detection processing. Then for each individual face in the face detection results, perform parts detection processing and attribute discrimination processing.<br>When executing the attribute discrimination processing function, pass a pointer to the attribute discrimination dictionary in an argument. The attribute discrimination dictionary must be read into memory in advance from an attribute discrimination dictionary data file.<br>Note that currently only one attribute can be discriminated, however, the APIs can support multiple attributes as future extensions.<br></div>

<div align=center>
<p>
<img src="gif/libface-Overview-English007.gif">
</div>
<br>
<div style="margin-left:50px;"><br></div>

<!-- sce_fignum -->
<div align=center>
<p>
<b>Figure 7  Attribute Discrimination Processing Procedure</b><br>
</div>
<br>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_6_1"><h4>
(1)&nbsp;<b>Execute face detection</b><br></h4>
</a></div>
<div style="margin-left:67px;">Prepare the input image and face detection result output area and execute face detection with the face detection parameters set as arguments. For details about the procedure, see the section "Face Detection Processing Procedure.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_6_2"><h4>
(2)&nbsp;<b>Execute parts detection</b><br></h4>
</a></div>
<div style="margin-left:67px;">Prepare the parts detection result output area and execute parts detection with the parts detection parameters set as arguments. For details about the procedure, see the section "Parts Detection Processing Procedure."<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_6_3"><h4>
(3)&nbsp;<b>Prepare the attribute discrimination result output area</b><br></h4>
</a></div>
<div style="margin-left:67px;">Prepare an array of <a href="../image_recognition/libface-Reference-English.htm#SceFaceAttribResult">SceFaceAttribResult</a> structures as the area for saving the output results from attribute discrimination. This array must have <a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_ATTRIB_NUM_MAX">SCE_FACE_ATTRIB_NUM_MAX</a>(1) elements.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_6_4"><h4>
(4)&nbsp;<b>Execute attribute discrimination</b><br></h4>
</a></div>
<div style="margin-left:67px;">Execute <a href="../image_recognition/libface-Reference-English.htm#sceFaceAttribute">sceFaceAttribute</a>() and set the attribute discrimination dictionary data address, information about the input image, face detection result that was obtained in (1), parts detection result that was obtained in (2), attribute discrimination result output area address, and number of elements in the attribute discrimination result array as arguments. <br>For the input image, use the same image that was used for face detection processing and parts detection processing. The image area must not be cleared until all attribute discrimination processing has finished.<br>Note that for attribute discrimination processing to complete, the parts detection results must have detected all four parts (right eye, left eye, nose and mouth).<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_6_5"><h4>
(5)&nbsp;<b>Receive attribute discrimination results</b><br></h4>
</a></div>
<div style="margin-left:67px;">When <a href="../image_recognition/libface-Reference-English.htm#sceFaceAttribute">sceFaceAttribute</a>() completes successfully, the number of attributes that were discriminated is returned in <i>numResultAttrib</i>. The attribute discrimination results are stored in the various elements of the <a href="../image_recognition/libface-Reference-English.htm#SceFaceAttribResult">SceFaceAttribResult</a> structure prepared in (3) and whose address was set in the <i>resultAttribArray</i> argument. The type of attribute is stored in the <i>attribId</i> member of the <a href="../image_recognition/libface-Reference-English.htm#SceFaceAttribResult">SceFaceAttribResult</a> structure and the discrimination result score is stored in <i>score</i>.<br>The smile attribute score, which reflects the degree of a smile, is output as a normalized value ranging from 0.0 to 100.0. A score of 20.0 represents an expressionless face. The closer the score is to 100.0, the bigger the smile, whereas, the closer the score is to 0.0, the more sorrowful or anguished the face is determined to be.<br></div>

<!-- sce_hd5 -->
<div style="margin-left:40px;"><a name="Heading5_2_6_6"><h4>
(6)&nbsp;<b>Repeat the process for all faces</b><br></h4>
</a></div>
<div style="margin-left:67px;">Repeat the processing of (4) and (5) for all faces detected in (1).<br></div>

<!-- sce_hd4 -->
<a name="Heading4_2_7">
<h3>
<a href="#Heading3_2"> 2. </a>7 
<!-- hp1 --><b>List of Functions</b><br>
</a>
</h3>
<div style="margin-left:50px;">libface functions can be divided into four areas: memory management, face detection, parts detection and attribute discrimination.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_2_7_5">
<div style="margin-left:40px;"><h4><b>Functions related to memory management</b><br><br></h4></div></a>

<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Function Name</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Description</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#sceFaceSetMallocFunction">sceFaceSetMallocFunction</a>()&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Sets memory management functions&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_title -->
<a Name ="HeadingT_2_7_6">
<div style="margin-left:40px;"><h4><b>Functions related to face detection</b><br><br></h4></div></a>

<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Function Name</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Description</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#sceFaceDetection">sceFaceDetection</a>()&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Executes face detection&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#sceFaceDetectionLocal">sceFaceDetectionLocal</a>()&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Executes fast face detection using a local search&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_title -->
<a Name ="HeadingT_2_7_7">
<div style="margin-left:40px;"><h4><b>Functions related to parts detection</b><br><br></h4></div></a>

<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Function Name</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Description</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#sceFaceParts">sceFaceParts</a>()&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Executes parts detection&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#sceFaceEstimateAngle">sceFaceEstimateAngle</a>()&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Estimates face angle according to detected parts positions&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_title -->
<a Name ="HeadingT_2_7_8">
<div style="margin-left:40px;"><h4><b>Functions related to attribute discrimination</b><br><br></h4></div></a>

<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Function Name</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Description</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#sceFaceAttribute">sceFaceAttribute</a>()&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Executes attribute discrimination&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_hd4 -->
<a name="Heading4_2_8">
<h3>
<a href="#Heading3_2"> 2. </a>8 
<!-- hp1 --><b>List of Face Detection Dictionaries</b><br>
</a>
</h3>
<div style="margin-left:50px;">To reduce memory consumption, libface provides face detection dictionary data in multiple files so that an application need only read and use the dictionaries that it requires.<br>More than one recognition processing dictionary is provided for face detection and parts detection, and the main difference between these dictionaries is in the supported range of face angles. Note that as the supported face angle gets wider, memory consumption and processing time also tend to increase, so you should choose the proper dictionary according to the required specifications of your application.<br></div>

<!-- sce_title -->
<a Name ="HeadingT_2_8_9">
<div style="margin-left:40px;"><h4><b>Face Detection Dictionaries</b><br><br></h4></div></a>

<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Macro and Filename</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Description</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_DETECT_FRONTAL_DICT">SCE_FACE_DETECT_FRONTAL_DICT</a>&nbsp;&nbsp;<br>&nbsp;&nbsp;"face_detect_frontal.fdt"&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Face detection dictionary data file&nbsp;&nbsp;<br>&nbsp;&nbsp;(for frontal face)&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_DETECT_FRONTAL_FAST_DICT">SCE_FACE_DETECT_FRONTAL_FAST_DICT</a>&nbsp;&nbsp;<br>&nbsp;&nbsp;"face_detect_frontal_fast.fdt"&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Face detection dictionary data file&nbsp;&nbsp;<br>&nbsp;&nbsp;(fast version for frontal face)&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_DETECT_ROLL_DICT">SCE_FACE_DETECT_ROLL_DICT</a>&nbsp;&nbsp;<br>&nbsp;&nbsp;"face_detect_roll.fdt"&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Face detection dictionary data file&nbsp;&nbsp;<br>&nbsp;&nbsp;(roll support)&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_DETECT_ROLL_YAW_DICT">SCE_FACE_DETECT_ROLL_YAW_DICT</a>&nbsp;&nbsp;<br>&nbsp;&nbsp;"face_detect_roll_yaw.fdt"&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Face detection dictionary data file&nbsp;&nbsp;<br>&nbsp;&nbsp;(roll and yaw support)&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_DETECT_ROLL_YAW_PITCH_DICT">SCE_FACE_DETECT_ROLL_YAW_PITCH_DICT</a>&nbsp;&nbsp;<br>&nbsp;&nbsp;"face_detect_roll_yaw_pitch.fdt"&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Face detection dictionary data file&nbsp;&nbsp;<br>&nbsp;&nbsp;(roll, yaw, and pitch support)&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_title -->
<a Name ="HeadingT_2_8_10">
<div style="margin-left:40px;"><h4><b>Parts Detection Dictionaries</b><br><br></h4></div></a>

<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Macro and Filename</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Description</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_PARTS_FRONTAL_ROLL_DICT">SCE_FACE_PARTS_FRONTAL_ROLL_DICT</a>&nbsp;&nbsp;<br>&nbsp;&nbsp;"face_parts_frontal_roll.pdt"&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Parts detection dictionary data file&nbsp;&nbsp;<br>&nbsp;&nbsp;(frontal face with roll support)&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_PARTS_ROLL_YAW_DICT">SCE_FACE_PARTS_ROLL_YAW_DICT</a>&nbsp;&nbsp;<br>&nbsp;&nbsp;"face_parts_roll_yaw.pdt"&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Parts detection dictionary data file&nbsp;&nbsp;<br>&nbsp;&nbsp;(roll and yaw support)&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- sce_title -->
<a Name ="HeadingT_2_8_11">
<div style="margin-left:40px;"><h4><b>Attribute Discrimination Dictionary</b><br><br></h4></div></a>

<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Macro and Filename</b>&nbsp;&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;&nbsp;<b>Description</b>&nbsp;&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;<a href="../image_recognition/libface-Reference-English.htm#SCE_FACE_ATTRIB_SMILE_DICT">SCE_FACE_ATTRIB_SMILE_DICT</a>&nbsp;&nbsp;<br>&nbsp;&nbsp;"face_attrib_smile.adt"&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;Attribute discrimination dictionary data file&nbsp;&nbsp;<br>&nbsp;&nbsp;(degree of smile)&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>

<!-- sce_hd3 -->
<a name="Heading3_3">
<h2>
 3 <!-- hp --><b>Precautions</b>
<hr noshade>
</h2>


<!-- sce_hd4 -->
<a name="Heading4_3_1">
<h3>
<a href="#Heading3_3"> 3. </a>1 
<!-- hp1 --><b>Processing Time and Memory Consumption</b><br>
</a>
</h3>
<div style="margin-left:50px;">Memory consumption and processing time can vary widely depending on the image size, dictionary type, and configuration parameters. Since the most appropriate values for each of these varies according to the application use, the library alone cannot determine their optimum values. When processing time or memory consumption is a problem, be sure to adjust these parameters so that they optimally match the required specifications of the application. Then confirm proper operation using images as similar as possible to those expected during actual usage conditions.<br>Although you can verify memory consumption in the sample program simple_face_my_malloc, be aware that this is a simple application. Memory consumption may vary in face detection according to the number of face candidates encountered during processing and it may also vary in parts detection or attribute discrimination as a function of the size of the detected faces. Try to allow for variations in memory consumption by making additional memory available.<br>Also, processing time may vary according to the image content even if all configuration parameters are the same. As much as possible, avoid creating situations that are known in advance to require some fixed amount of processing time.<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_2">
<h3>
<a href="#Heading3_3"> 3. </a>2 
<!-- hp1 --><b>Misrecognition</b><br>
</a>
</h3>
<div style="margin-left:50px;">Detection omissions or misdetection may occur during face detection or parts detection. Also, discrimination errors may occur during attribute discrimination depending on the state of the image or photographic conditions of the face. Even if the occurrence rate of such recognition errors could be reduced by input image adjustments or parameter adjustments as properties of image recognition, it is fundamentally impossible to reduce them to zero. Therefore, it is recommended that you add a means of handling errors in the application so that even if some recognition errors do occur, they will not cause problems.<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_3">
<h3>
<a href="#Heading3_3"> 3. </a>3 
<!-- hp1 --><b>Library Implementation</b><br>
</a>
</h3>
<div style="margin-left:50px;">The current implementation of libface does not require the use of special hardware resources such as the VFPU, scratchpad memory, eDRAM, Graphics Engine, or DMAC.<br></div>

<!-- sce_hd4 -->
<a name="Heading4_3_4">
<h3>
<a href="#Heading3_3"> 3. </a>4 
<!-- hp1 --><b>Packaging of Face Detection Dictionary Data Files </b><br>
</a>
</h3>
<div style="margin-left:50px;">Since libface.prx previously contained all face detection dictionary data, it was relatively large and memory was needlessly consumed when only a small dictionary was used. Therefore, the dictionary data was separated out from the PRX module into independent files. Not only did this reduce the size of libface.prx, but by enabling the application to selectively read only the required dictionary files it also reduced the amount of memory consumed.<br><br></div>
<p><p><hr>
<div ALIGN="right">
    &copy;2009 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
